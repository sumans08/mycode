/*!--------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/(function(){var A=["require","exports","vs/workbench/services/search/common/getFileResults","vs/workbench/services/search/common/ignoreFile","vs/base/common/glob","vs/editor/common/core/range","vs/workbench/services/search/worker/localFileSearch","vs/base/common/uri","vs/base/common/extpath","vs/base/common/path","vs/base/common/cancellation","vs/base/common/strings","vs/base/common/async"],N=function(W){for(var h=[],g=0,S=W.length;g<S;g++)h[g]=A[W[g]];return h};define(A[2],N([0,1,5]),function(W,h,g){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.getFileResults=void 0;const S=(F,r,i)=>{let s;if(F[0]===255&&F[1]===254)s=new TextDecoder("utf-16le").decode(F);else if(F[0]===254&&F[1]===255)s=new TextDecoder("utf-16be").decode(F);else if(s=new TextDecoder("utf8").decode(F),s.slice(0,1e3).includes("\uFFFD")&&F.includes(0))return[];const x=[],m=[];let u=null,L=i.remainingResultQuota;for(;L>=0&&(u=r.exec(s));)m.push({matchStartIndex:u.index,matchedText:u[0]}),L--;if(m.length){const P=new Set,M=new Set,a=[],Q=e=>s.slice(a[e].start,a[e].end);let T=0,C=null;const H=/\r?\n/g;for(;C=H.exec(s);)a.push({start:T,end:C.index}),T=C.index+C[0].length;T<s.length&&a.push({start:T,end:s.length});let t=0;for(const{matchStartIndex:e,matchedText:o}of m){if(L<0)break;for(;Boolean(a[t+1])&&e>a[t].end;)t++;let n=t;for(;Boolean(a[n+1])&&e+o.length>a[n].end;)n++;if(i.beforeContext)for(let l=Math.max(0,t-i.beforeContext);l<t;l++)P.add(l);let f="",w=0;for(let l=t;l<=n;l++){let I=Q(l);i.previewOptions?.charsPerLine&&I.length>i.previewOptions.charsPerLine&&(w=Math.max(e-a[t].start-20,0),I=I.substr(w,i.previewOptions.charsPerLine)),f+=`${I}
`,M.add(l)}const v=new g.Range(t,e-a[t].start,n,e+o.length-a[n].start),R=new g.Range(0,e-a[t].start-w,n-t,e+o.length-a[n].start-(n===t?w:0)),E={ranges:v,preview:{text:f,matches:R}};if(x.push(E),i.afterContext)for(let l=n+1;l<=Math.min(n+i.afterContext,a.length-1);l++)P.add(l)}for(const e of P)M.has(e)||x.push({text:Q(e),lineNumber:e+1})}return x};h.getFileResults=S}),define(A[3],N([0,1,4]),function(W,h,g){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.IgnoreFile=void 0;class S{constructor(r,i,s){this.isPathIgnored=this.parseIgnoreFile(r,i,s)}isPathIncludedInTraversal(r,i){if(r[0]!=="/"||r[r.length-1]==="/")throw Error("Unexpected path format, expectred to begin with slash and end without. got:"+r);return!this.isPathIgnored(r,i)}isArbitraryPathIgnored(r,i){if(r[0]!=="/"||r[r.length-1]==="/")throw Error("Unexpected path format, expectred to begin with slash and end without. got:"+r);const s=r.split("/").filter(u=>u);let x=!1,m="";for(let u=0;u<s.length;u++){const L=u===s.length-1,P=s[u];if(m=m+"/"+P,!this.isPathIncludedInTraversal(m,L?i:!0)){x=!0;break}}return x}gitignoreLinesToExpression(r,i,s){const x=r.map(u=>this.gitignoreLineToGlob(u,i)),m=Object.create(null);for(const u of x)m[u]=!0;return g.parse(m,{trimForExclusions:s})}parseIgnoreFile(r,i,s){const x=r.split(`
`).map(t=>t.trim()).filter(t=>t&&t[0]!=="#"),m=x.filter(t=>!t.endsWith("/")),u=m.filter(t=>!t.includes("!")),L=this.gitignoreLinesToExpression(u,i,!0),P=m.filter(t=>t.includes("!")).map(t=>t.replace(/!/g,"")),M=this.gitignoreLinesToExpression(P,i,!1),a=x.filter(t=>!t.includes("!")),Q=this.gitignoreLinesToExpression(a,i,!0),T=x.filter(t=>t.includes("!")).map(t=>t.replace(/!/g,"")),C=this.gitignoreLinesToExpression(T,i,!1);return(t,e)=>t.startsWith(i)?e&&Q(t)&&!C(t)||L(t)&&!M(t)?!0:s?s.isPathIgnored(t,e):!1:!1}gitignoreLineToGlob(r,i){const s=r.indexOf("/");return s===-1||s===r.length-1?r="**/"+r:(s===0&&(r=r.slice(1)),r=i+r),r}}h.IgnoreFile=S}),define(A[6],N([0,1,4,7,8,9,10,2,3,11,12]),function(W,h,g,S,F,r,i,s,x,m,u){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.LocalFileSearchSimpleWorker=h.create=void 0;const L=!1,P=+new Date,M={},a=async(e,o)=>{if(!L)return o();const n=Date.now(),f=(M[e]??0)+1;console.info(e,f,"starting",Math.round((n-P)*10)/1e4),M[e]=f;const w=await o(),v=Date.now();return console.info(e,f,"took",v-n),w};function Q(e){return new T(e)}h.create=Q;class T{constructor(o){this.host=o,this.cancellationTokens=new Map}cancelQuery(o){this.cancellationTokens.get(o)?.cancel()}registerCancellationToken(o){const n=new i.CancellationTokenSource;return this.cancellationTokens.set(o,n),n}async listDirectory(o,n,f,w){const v=this.registerCancellationToken(w),R=[];let E=!1,l=0;const I=n.maxResults||512,D=n.filePattern?k=>n.filePattern.split("").every(U=>k.includes(U)):k=>!0;return await a("listDirectory",()=>this.walkFolderQuery(o,n,f,k=>{if(!!D(k.name))return l++,I&&l>I&&(E=!0,v.cancel()),R.push(k.path)},v.token)),{results:R,limitHit:E}}async searchDirectory(o,n,f,w){return a("searchInFiles",async()=>{const v=this.registerCancellationToken(w),R=[],E=C(n.contentPattern),l=[];let I=0,D=0,k=!1;const U=async c=>{if(v.token.isCancellationRequested)return;I++;const p=await c.resolve();if(v.token.isCancellationRequested)return;const d=new Uint8Array(p),b=(0,s.getFileResults)(d,E,{afterContext:n.afterContext??0,beforeContext:n.beforeContext??0,previewOptions:n.previewOptions,remainingResultQuota:n.maxResults?n.maxResults-D:1e4});if(b.length){D+=b.length,n.maxResults&&D>n.maxResults&&v.cancel();const y={resource:S.URI.joinPath(S.URI.revive(f.folder),c.path),results:b};this.host.sendTextSearchMatch(y,w),R.push(y)}};return await a("walkFolderToResolve",()=>this.walkFolderQuery(o,n,f,async c=>l.push(U(c)),v.token)),await a("resolveOngoingProcesses",()=>Promise.all(l)),L&&console.log("Searched in",I,"files"),{results:R,limitHit:k}})}async walkFolderQuery(o,n,f,w,v){const R=g.parse(f.excludePattern??{},{trimForExclusions:!0}),E=(c,p,d)=>(c=c.slice(1),!!(R(c,p,d)||H(n,c))),l=(c,p,d)=>(c=c.slice(1),!(R(c,p,d)||!t(n,c))),I=(c,p)=>({type:"file",name:c.name,path:p,resolve:()=>c.getFile().then(b=>b.arrayBuffer())}),D=async(c,p,d)=>{if(!f.disregardIgnoreFiles){const y=await Promise.all([c.getFileHandle(".gitignore").catch(O=>{}),c.getFileHandle(".ignore").catch(O=>{})]);await Promise.all(y.map(async O=>{if(!O)return;const G=new TextDecoder("utf8").decode(new Uint8Array(await(await O.getFile()).arrayBuffer()));d=new x.IgnoreFile(G,p,d)}))}const b=u.Promises.withAsyncBody(async y=>{const O=[],G=[],$=[],z=new Set;for await(const _ of c.entries())$.push(_),z.add(_[0]);for(const[_,j]of $){if(v.isCancellationRequested)break;const B=p+_;if(d&&!d.isPathIncludedInTraversal(B,j.kind==="directory"))continue;const J=K=>z.has(K);j.kind==="directory"&&!E(B,_,J)?G.push(D(j,B+"/",d)):j.kind==="file"&&l(B,_,J)&&O.push(I(j,B))}y([...await Promise.all(G),...O])});return{type:"dir",name:c.name,entries:b}},k=async(c,p)=>{v.isCancellationRequested||await Promise.all((await c.entries).sort((d,b)=>-(d.type==="dir"?0:1)+(b.type==="dir"?0:1)).map(async d=>d.type==="dir"?k(d,p):p(d)))},U=await a("process",()=>D(o,"/"));await a("resolve",()=>k(U,w))}}h.LocalFileSearchSimpleWorker=T;function C(e){return(0,m.createRegExp)(e.pattern,!!e.isRegExp,{wholeWord:e.isWordMatch,global:!0,matchCase:e.isCaseSensitive,multiline:!0,unicode:!0})}function H(e,o){return!!(e.excludePattern&&g.match(e.excludePattern,o))}function t(e,o){return e.excludePattern&&g.match(e.excludePattern,o)?!1:e.includePattern||e.usingSearchPaths?e.includePattern&&g.match(e.includePattern,o)?!0:e.usingSearchPaths?!!e.folderQueries&&e.folderQueries.some(n=>{const f=n.folder.path;if(F.isEqualOrParent(o,f)){const w=r.relative(f,o);return!n.includePattern||!!g.match(n.includePattern,w)}else return!1}):!1:!0}})}).call(this);

//# sourceMappingURL=localFileSearch.js.map
