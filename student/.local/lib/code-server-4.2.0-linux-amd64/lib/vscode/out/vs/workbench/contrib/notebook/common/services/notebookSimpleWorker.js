/*!--------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/(function(){var W=["require","exports","vs/base/common/strings","vs/base/common/buffer","vs/base/common/platform","vs/editor/common/model/pieceTreeTextBuffer/pieceTreeBase","vs/editor/common/core/range","vs/base/common/mime","vs/base/common/path","vs/base/common/stream","vs/base/common/lifecycle","vs/editor/common/core/eolCounter","vs/editor/common/core/stringBuilder","vs/editor/common/core/textChange","vs/editor/common/model/pieceTreeTextBuffer/rbTreeBase","vs/editor/common/model","vs/editor/common/model/pieceTreeTextBuffer/pieceTreeTextBuffer","vs/editor/common/model/pieceTreeTextBuffer/pieceTreeTextBufferBuilder","vs/platform/instantiation/common/instantiation","vs/platform/contextkey/common/contextkey","vs/workbench/contrib/notebook/common/notebookCommon","vs/base/common/errors","vs/editor/common/core/position","vs/editor/common/model/textModelSearch","vs/base/common/event","vs/base/common/glob","vs/base/common/iterator","vs/base/common/network","vs/workbench/contrib/notebook/common/services/notebookSimpleWorker","vs/base/common/diff/diff","vs/base/common/hash","vs/base/common/uri"],$=function(z){for(var r=[],B=0,U=z.length;B<U;B++)r[B]=W[z[B]];return r};define(W[7],$([0,1,8]),function(z,r,B){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.normalizeMimeType=r.getExtensionForMimeType=r.getMediaMime=r.getMediaOrTextMime=r.Mimes=void 0;var U;(function(I){I.text="text/plain",I.binary="application/octet-stream",I.unknown="application/unknown",I.markdown="text/markdown",I.latex="text/latex"})(U=r.Mimes||(r.Mimes={}));const P={".css":"text/css",".csv":"text/csv",".htm":"text/html",".html":"text/html",".ics":"text/calendar",".js":"text/javascript",".mjs":"text/javascript",".txt":"text/plain",".xml":"text/xml"},b={".aac":"audio/x-aac",".avi":"video/x-msvideo",".bmp":"image/bmp",".flv":"video/x-flv",".gif":"image/gif",".ico":"image/x-icon",".jpe":"image/jpg",".jpeg":"image/jpg",".jpg":"image/jpg",".m1v":"video/mpeg",".m2a":"audio/mpeg",".m2v":"video/mpeg",".m3a":"audio/mpeg",".mid":"audio/midi",".midi":"audio/midi",".mk3d":"video/x-matroska",".mks":"video/x-matroska",".mkv":"video/x-matroska",".mov":"video/quicktime",".movie":"video/x-sgi-movie",".mp2":"audio/mpeg",".mp2a":"audio/mpeg",".mp3":"audio/mpeg",".mp4":"video/mp4",".mp4a":"audio/mp4",".mp4v":"video/mp4",".mpe":"video/mpeg",".mpeg":"video/mpeg",".mpg":"video/mpeg",".mpg4":"video/mp4",".mpga":"audio/mpeg",".oga":"audio/ogg",".ogg":"audio/ogg",".opus":"audio/opus",".ogv":"video/ogg",".png":"image/png",".psd":"image/vnd.adobe.photoshop",".qt":"video/quicktime",".spx":"audio/ogg",".svg":"image/svg+xml",".tga":"image/x-tga",".tif":"image/tiff",".tiff":"image/tiff",".wav":"audio/x-wav",".webm":"video/webm",".webp":"image/webp",".wma":"audio/x-ms-wma",".wmv":"video/x-ms-wmv",".woff":"application/font-woff"};function O(I){const h=(0,B.extname)(I),N=P[h.toLowerCase()];return N!==void 0?N:D(I)}r.getMediaOrTextMime=O;function D(I){const h=(0,B.extname)(I);return b[h.toLowerCase()]}r.getMediaMime=D;function R(I){for(const h in b)if(b[h]===I)return h}r.getExtensionForMimeType=R;const m=/^(.+)\/(.+?)(;.+)?$/;function _(I,h){const N=m.exec(I);return N?`${N[1].toLowerCase()}/${N[2].toLowerCase()}${N[3]??""}`:h?void 0:I}r.normalizeMimeType=_}),define(W[9],$([0,1,21,10]),function(z,r,B,U){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.prefixedStream=r.prefixedReadable=r.transform=r.toReadable=r.emptyStream=r.toStream=r.peekStream=r.listenStream=r.consumeStream=r.peekReadable=r.consumeReadable=r.newWriteableStream=r.isReadableBufferedStream=r.isReadableStream=void 0;function P(n){const s=n;return s?[s.on,s.pause,s.resume,s.destroy].every(l=>typeof l=="function"):!1}r.isReadableStream=P;function b(n){const s=n;return s?P(s.stream)&&Array.isArray(s.buffer)&&typeof s.ended=="boolean":!1}r.isReadableBufferedStream=b;function O(n,s){return new D(n,s)}r.newWriteableStream=O;class D{constructor(s,l){this.reducer=s,this.options=l,this.state={flowing:!1,ended:!1,destroyed:!1},this.buffer={data:[],error:[]},this.listeners={data:[],error:[],end:[]},this.pendingWritePromises=[]}pause(){this.state.destroyed||(this.state.flowing=!1)}resume(){this.state.destroyed||this.state.flowing||(this.state.flowing=!0,this.flowData(),this.flowErrors(),this.flowEnd())}write(s){if(!this.state.destroyed){if(this.state.flowing)this.emitData(s);else if(this.buffer.data.push(s),typeof this.options?.highWaterMark=="number"&&this.buffer.data.length>this.options.highWaterMark)return new Promise(l=>this.pendingWritePromises.push(l))}}error(s){this.state.destroyed||(this.state.flowing?this.emitError(s):this.buffer.error.push(s))}end(s){this.state.destroyed||(typeof s!="undefined"&&this.write(s),this.state.flowing?(this.emitEnd(),this.destroy()):this.state.ended=!0)}emitData(s){this.listeners.data.slice(0).forEach(l=>l(s))}emitError(s){this.listeners.error.length===0?(0,B.onUnexpectedError)(s):this.listeners.error.slice(0).forEach(l=>l(s))}emitEnd(){this.listeners.end.slice(0).forEach(s=>s())}on(s,l){if(!this.state.destroyed)switch(s){case"data":this.listeners.data.push(l),this.resume();break;case"end":this.listeners.end.push(l),this.state.flowing&&this.flowEnd()&&this.destroy();break;case"error":this.listeners.error.push(l),this.state.flowing&&this.flowErrors();break}}removeListener(s,l){if(this.state.destroyed)return;let o;switch(s){case"data":o=this.listeners.data;break;case"end":o=this.listeners.end;break;case"error":o=this.listeners.error;break}if(o){const L=o.indexOf(l);L>=0&&o.splice(L,1)}}flowData(){if(this.buffer.data.length>0){const s=this.reducer(this.buffer.data);this.emitData(s),this.buffer.data.length=0;const l=[...this.pendingWritePromises];this.pendingWritePromises.length=0,l.forEach(o=>o())}}flowErrors(){if(this.listeners.error.length>0){for(const s of this.buffer.error)this.emitError(s);this.buffer.error.length=0}}flowEnd(){return this.state.ended?(this.emitEnd(),this.listeners.end.length>0):!1}destroy(){this.state.destroyed||(this.state.destroyed=!0,this.state.ended=!0,this.buffer.data.length=0,this.buffer.error.length=0,this.listeners.data.length=0,this.listeners.error.length=0,this.listeners.end.length=0,this.pendingWritePromises.length=0)}}function R(n,s){const l=[];let o;for(;(o=n.read())!==null;)l.push(o);return s(l)}r.consumeReadable=R;function m(n,s,l){const o=[];let L;for(;(L=n.read())!==null&&o.length<l;)o.push(L);return L===null&&o.length>0?s(o):{read:()=>{if(o.length>0)return o.shift();if(typeof L!="undefined"){const C=L;return L=void 0,C}return n.read()}}}r.peekReadable=m;function _(n,s){return new Promise((l,o)=>{const L=[];I(n,{onData:C=>{s&&L.push(C)},onError:C=>{s?o(C):l(void 0)},onEnd:()=>{l(s?s(L):void 0)}})})}r.consumeStream=_;function I(n,s){let l=!1;return n.on("error",o=>{l||s.onError(o)}),n.on("end",()=>{l||s.onEnd()}),n.on("data",o=>{l||s.onData(o)}),(0,U.toDisposable)(()=>l=!0)}r.listenStream=I;function h(n,s){return new Promise((l,o)=>{const L=new U.DisposableStore,C=[],T=p=>{if(C.push(p),C.length>s)return L.dispose(),n.pause(),l({stream:n,buffer:C,ended:!1})},E=p=>o(p),S=()=>l({stream:n,buffer:C,ended:!0});L.add((0,U.toDisposable)(()=>n.removeListener("error",E))),n.on("error",E),L.add((0,U.toDisposable)(()=>n.removeListener("end",S))),n.on("end",S),L.add((0,U.toDisposable)(()=>n.removeListener("data",T))),n.on("data",T)})}r.peekStream=h;function N(n,s){const l=O(s);return l.end(n),l}r.toStream=N;function v(){const n=O(()=>{throw new Error("not supported")});return n.end(),n}r.emptyStream=v;function c(n){let s=!1;return{read:()=>s?null:(s=!0,n)}}r.toReadable=c;function a(n,s,l){const o=O(l);return I(n,{onData:L=>o.write(s.data(L)),onError:L=>o.error(s.error?s.error(L):L),onEnd:()=>o.end()}),o}r.transform=a;function e(n,s,l){let o=!1;return{read:()=>{const L=s.read();return o?L:(o=!0,L!==null?l([n,L]):n)}}}r.prefixedReadable=e;function i(n,s,l){let o=!1;const L=O(l);return I(s,{onData:C=>o?L.write(C):(o=!0,L.write(l([n,C]))),onError:C=>L.error(C),onEnd:()=>{o||(o=!0,L.write(n)),L.end()}}),L}r.prefixedStream=i}),define(W[3],$([0,1,9]),function(z,r,B){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.encodeBase64=r.decodeBase64=r.prefixedBufferStream=r.prefixedBufferReadable=r.newWriteableBufferStream=r.streamToBufferReadableStream=r.bufferToStream=r.bufferedStreamToBuffer=r.streamToBuffer=r.bufferToReadable=r.readableToBuffer=r.writeUInt8=r.readUInt8=r.writeUInt32LE=r.readUInt32LE=r.writeUInt32BE=r.readUInt32BE=r.writeUInt16LE=r.readUInt16LE=r.VSBuffer=void 0;const U=typeof Buffer!="undefined";let P,b;class O{constructor(f){this.buffer=f,this.byteLength=this.buffer.byteLength}static alloc(f){return U?new O(Buffer.allocUnsafe(f)):new O(new Uint8Array(f))}static wrap(f){return U&&!Buffer.isBuffer(f)&&(f=Buffer.from(f.buffer,f.byteOffset,f.byteLength)),new O(f)}static fromString(f,y){return!(y?.dontUseNodeBuffer||!1)&&U?new O(Buffer.from(f)):(P||(P=new TextEncoder),new O(P.encode(f)))}static fromByteArray(f){const y=O.alloc(f.length);for(let d=0,k=f.length;d<k;d++)y.buffer[d]=f[d];return y}static concat(f,y){if(typeof y=="undefined"){y=0;for(let M=0,w=f.length;M<w;M++)y+=f[M].byteLength}const d=O.alloc(y);let k=0;for(let M=0,w=f.length;M<w;M++){const t=f[M];d.set(t,k),k+=t.byteLength}return d}clone(){const f=O.alloc(this.byteLength);return f.set(this),f}toString(){return U?this.buffer.toString():(b||(b=new TextDecoder),b.decode(this.buffer))}slice(f,y){return new O(this.buffer.subarray(f,y))}set(f,y){if(f instanceof O)this.buffer.set(f.buffer,y);else if(f instanceof Uint8Array)this.buffer.set(f,y);else if(f instanceof ArrayBuffer)this.buffer.set(new Uint8Array(f),y);else if(ArrayBuffer.isView(f))this.buffer.set(new Uint8Array(f.buffer,f.byteOffset,f.byteLength),y);else throw new Error("Unkown argument 'array'")}readUInt32BE(f){return m(this.buffer,f)}writeUInt32BE(f,y){_(this.buffer,f,y)}readUInt32LE(f){return I(this.buffer,f)}writeUInt32LE(f,y){h(this.buffer,f,y)}readUInt8(f){return N(this.buffer,f)}writeUInt8(f,y){v(this.buffer,f,y)}}r.VSBuffer=O;function D(p,f){return p[f+0]<<0>>>0|p[f+1]<<8>>>0}r.readUInt16LE=D;function R(p,f,y){p[y+0]=f&255,f=f>>>8,p[y+1]=f&255}r.writeUInt16LE=R;function m(p,f){return p[f]*2**24+p[f+1]*2**16+p[f+2]*2**8+p[f+3]}r.readUInt32BE=m;function _(p,f,y){p[y+3]=f,f=f>>>8,p[y+2]=f,f=f>>>8,p[y+1]=f,f=f>>>8,p[y]=f}r.writeUInt32BE=_;function I(p,f){return p[f+0]<<0>>>0|p[f+1]<<8>>>0|p[f+2]<<16>>>0|p[f+3]<<24>>>0}r.readUInt32LE=I;function h(p,f,y){p[y+0]=f&255,f=f>>>8,p[y+1]=f&255,f=f>>>8,p[y+2]=f&255,f=f>>>8,p[y+3]=f&255}r.writeUInt32LE=h;function N(p,f){return p[f]}r.readUInt8=N;function v(p,f,y){p[y]=f}r.writeUInt8=v;function c(p){return B.consumeReadable(p,f=>O.concat(f))}r.readableToBuffer=c;function a(p){return B.toReadable(p)}r.bufferToReadable=a;function e(p){return B.consumeStream(p,f=>O.concat(f))}r.streamToBuffer=e;async function i(p){return p.ended?O.concat(p.buffer):O.concat([...p.buffer,await e(p.stream)])}r.bufferedStreamToBuffer=i;function n(p){return B.toStream(p,f=>O.concat(f))}r.bufferToStream=n;function s(p){return B.transform(p,{data:f=>typeof f=="string"?O.fromString(f):O.wrap(f)},f=>O.concat(f))}r.streamToBufferReadableStream=s;function l(p){return B.newWriteableStream(f=>O.concat(f),p)}r.newWriteableBufferStream=l;function o(p,f){return B.prefixedReadable(p,f,y=>O.concat(y))}r.prefixedBufferReadable=o;function L(p,f){return B.prefixedStream(p,f,y=>O.concat(y))}r.prefixedBufferStream=L;function C(p){let f=0,y=0,d=0;const k=new Uint8Array(Math.floor(p.length/4*3)),M=t=>{switch(y){case 3:k[d++]=f|t,y=0;break;case 2:k[d++]=f|t>>>2,f=t<<6,y=3;break;case 1:k[d++]=f|t>>>4,f=t<<4,y=2;break;default:f=t<<2,y=1}};for(let t=0;t<p.length;t++){const u=p.charCodeAt(t);if(u>=65&&u<=90)M(u-65);else if(u>=97&&u<=122)M(u-97+26);else if(u>=48&&u<=57)M(u-48+52);else if(u===43||u===45)M(62);else if(u===47||u===95)M(63);else{if(u===61)break;throw new SyntaxError(`Unexpected base64 character ${p[t]}`)}}const w=d;for(;y>0;)M(0);return O.wrap(k).slice(0,w)}r.decodeBase64=C;const T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function S({buffer:p},f=!0,y=!1){const d=y?E:T;let k="";const M=p.byteLength%3;let w=0;for(;w<p.byteLength-M;w+=3){const t=p[w+0],u=p[w+1],g=p[w+2];k+=d[t>>>2],k+=d[(t<<4|u>>>4)&63],k+=d[(u<<2|g>>>6)&63],k+=d[g&63]}if(M===1){const t=p[w+0];k+=d[t>>>2],k+=d[t<<4&63],f&&(k+="==")}else if(M===2){const t=p[w+0],u=p[w+1];k+=d[t>>>2],k+=d[(t<<4|u>>>4)&63],k+=d[u<<2&63],f&&(k+="=")}return k}r.encodeBase64=S}),define(W[11],$([0,1]),function(z,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.countEOL=r.StringEOL=void 0;var B;(function(P){P[P.Unknown=0]="Unknown",P[P.Invalid=3]="Invalid",P[P.LF=1]="LF",P[P.CRLF=2]="CRLF"})(B=r.StringEOL||(r.StringEOL={}));function U(P){let b=0,O=0,D=0,R=0;for(let m=0,_=P.length;m<_;m++){const I=P.charCodeAt(m);I===13?(b===0&&(O=m),b++,m+1<_&&P.charCodeAt(m+1)===10?(R|=2,m++):R|=3,D=m+1):I===10&&(R|=1,b===0&&(O=m),b++,D=m+1)}return b===0&&(O=P.length),[b,O,P.length-D,R]}r.countEOL=U}),define(W[12],$([0,1,2,4,3]),function(z,r,B,U,P){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.decodeUTF16LE=r.createStringBuilder=r.hasTextDecoder=r.getPlatformTextDecoder=void 0;let b;function O(){return b||(b=new TextDecoder("UTF-16LE")),b}let D;function R(){return D||(D=new TextDecoder("UTF-16BE")),D}let m;function _(){return m||(m=U.isLittleEndian()?O():R()),m}r.getPlatformTextDecoder=_,r.hasTextDecoder=typeof TextDecoder!="undefined",r.hasTextDecoder?(r.createStringBuilder=c=>new N(c),r.decodeUTF16LE=I):(r.createStringBuilder=c=>new v,r.decodeUTF16LE=h);function I(c,a,e){const i=new Uint16Array(c.buffer,a,e);return e>0&&(i[0]===65279||i[0]===65534)?h(c,a,e):O().decode(i)}function h(c,a,e){const i=[];let n=0;for(let s=0;s<e;s++){const l=P.readUInt16LE(c,a);a+=2,i[n++]=String.fromCharCode(l)}return i.join("")}class N{constructor(a){this._capacity=a|0,this._buffer=new Uint16Array(this._capacity),this._completedStrings=null,this._bufferLength=0}reset(){this._completedStrings=null,this._bufferLength=0}build(){return this._completedStrings!==null?(this._flushBuffer(),this._completedStrings.join("")):this._buildBuffer()}_buildBuffer(){if(this._bufferLength===0)return"";const a=new Uint16Array(this._buffer.buffer,0,this._bufferLength);return _().decode(a)}_flushBuffer(){const a=this._buildBuffer();this._bufferLength=0,this._completedStrings===null?this._completedStrings=[a]:this._completedStrings[this._completedStrings.length]=a}write1(a){const e=this._capacity-this._bufferLength;e<=1&&(e===0||B.isHighSurrogate(a))&&this._flushBuffer(),this._buffer[this._bufferLength++]=a}appendASCII(a){this._bufferLength===this._capacity&&this._flushBuffer(),this._buffer[this._bufferLength++]=a}appendASCIIString(a){const e=a.length;if(this._bufferLength+e>=this._capacity){this._flushBuffer(),this._completedStrings[this._completedStrings.length]=a;return}for(let i=0;i<e;i++)this._buffer[this._bufferLength++]=a.charCodeAt(i)}}class v{constructor(){this._pieces=[],this._piecesLen=0}reset(){this._pieces=[],this._piecesLen=0}build(){return this._pieces.join("")}write1(a){this._pieces[this._piecesLen++]=String.fromCharCode(a)}appendASCII(a){this._pieces[this._piecesLen++]=String.fromCharCode(a)}appendASCIIString(a){this._pieces[this._piecesLen++]=a}}}),define(W[13],$([0,1,3,12]),function(z,r,B,U){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.compressConsecutiveTextChanges=r.TextChange=void 0;function P(R){return R.replace(/\n/g,"\\n").replace(/\r/g,"\\r")}class b{constructor(m,_,I,h){this.oldPosition=m,this.oldText=_,this.newPosition=I,this.newText=h}get oldLength(){return this.oldText.length}get oldEnd(){return this.oldPosition+this.oldText.length}get newLength(){return this.newText.length}get newEnd(){return this.newPosition+this.newText.length}toString(){return this.oldText.length===0?`(insert@${this.oldPosition} "${P(this.newText)}")`:this.newText.length===0?`(delete@${this.oldPosition} "${P(this.oldText)}")`:`(replace@${this.oldPosition} "${P(this.oldText)}" with "${P(this.newText)}")`}static _writeStringSize(m){return 4+2*m.length}static _writeString(m,_,I){const h=_.length;B.writeUInt32BE(m,h,I),I+=4;for(let N=0;N<h;N++)B.writeUInt16LE(m,_.charCodeAt(N),I),I+=2;return I}static _readString(m,_){const I=B.readUInt32BE(m,_);return _+=4,(0,U.decodeUTF16LE)(m,_,I)}writeSize(){return 4+4+b._writeStringSize(this.oldText)+b._writeStringSize(this.newText)}write(m,_){return B.writeUInt32BE(m,this.oldPosition,_),_+=4,B.writeUInt32BE(m,this.newPosition,_),_+=4,_=b._writeString(m,this.oldText,_),_=b._writeString(m,this.newText,_),_}static read(m,_,I){const h=B.readUInt32BE(m,_);_+=4;const N=B.readUInt32BE(m,_);_+=4;const v=b._readString(m,_);_+=b._writeStringSize(v);const c=b._readString(m,_);return _+=b._writeStringSize(c),I.push(new b(h,v,N,c)),_}}r.TextChange=b;function O(R,m){return R===null||R.length===0?m:new D(R,m).compress()}r.compressConsecutiveTextChanges=O;class D{constructor(m,_){this._prevEdits=m,this._currEdits=_,this._result=[],this._resultLen=0,this._prevLen=this._prevEdits.length,this._prevDeltaOffset=0,this._currLen=this._currEdits.length,this._currDeltaOffset=0}compress(){let m=0,_=0,I=this._getPrev(m),h=this._getCurr(_);for(;m<this._prevLen||_<this._currLen;){if(I===null){this._acceptCurr(h),h=this._getCurr(++_);continue}if(h===null){this._acceptPrev(I),I=this._getPrev(++m);continue}if(h.oldEnd<=I.newPosition){this._acceptCurr(h),h=this._getCurr(++_);continue}if(I.newEnd<=h.oldPosition){this._acceptPrev(I),I=this._getPrev(++m);continue}if(h.oldPosition<I.newPosition){const[e,i]=D._splitCurr(h,I.newPosition-h.oldPosition);this._acceptCurr(e),h=i;continue}if(I.newPosition<h.oldPosition){const[e,i]=D._splitPrev(I,h.oldPosition-I.newPosition);this._acceptPrev(e),I=i;continue}let c,a;if(h.oldEnd===I.newEnd)c=I,a=h,I=this._getPrev(++m),h=this._getCurr(++_);else if(h.oldEnd<I.newEnd){const[e,i]=D._splitPrev(I,h.oldLength);c=e,a=h,I=i,h=this._getCurr(++_)}else{const[e,i]=D._splitCurr(h,I.newLength);c=I,a=e,I=this._getPrev(++m),h=i}this._result[this._resultLen++]=new b(c.oldPosition,c.oldText,a.newPosition,a.newText),this._prevDeltaOffset+=c.newLength-c.oldLength,this._currDeltaOffset+=a.newLength-a.oldLength}const N=D._merge(this._result);return D._removeNoOps(N)}_acceptCurr(m){this._result[this._resultLen++]=D._rebaseCurr(this._prevDeltaOffset,m),this._currDeltaOffset+=m.newLength-m.oldLength}_getCurr(m){return m<this._currLen?this._currEdits[m]:null}_acceptPrev(m){this._result[this._resultLen++]=D._rebasePrev(this._currDeltaOffset,m),this._prevDeltaOffset+=m.newLength-m.oldLength}_getPrev(m){return m<this._prevLen?this._prevEdits[m]:null}static _rebaseCurr(m,_){return new b(_.oldPosition-m,_.oldText,_.newPosition,_.newText)}static _rebasePrev(m,_){return new b(_.oldPosition,_.oldText,_.newPosition+m,_.newText)}static _splitPrev(m,_){const I=m.newText.substr(0,_),h=m.newText.substr(_);return[new b(m.oldPosition,m.oldText,m.newPosition,I),new b(m.oldEnd,"",m.newPosition+_,h)]}static _splitCurr(m,_){const I=m.oldText.substr(0,_),h=m.oldText.substr(_);return[new b(m.oldPosition,I,m.newPosition,m.newText),new b(m.oldPosition+_,h,m.newEnd,"")]}static _merge(m){if(m.length===0)return m;const _=[];let I=0,h=m[0];for(let N=1;N<m.length;N++){const v=m[N];h.oldEnd===v.oldPosition?h=new b(h.oldPosition,h.oldText+v.oldText,h.newPosition,h.newText+v.newText):(_[I++]=h,h=v)}return _[I++]=h,_}static _removeNoOps(m){if(m.length===0)return m;const _=[];let I=0;for(let h=0;h<m.length;h++){const N=m[h];N.oldText!==N.newText&&(_[I++]=N)}return _}}}),define(W[14],$([0,1]),function(z,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.recomputeTreeMetadata=r.updateTreeMetadata=r.fixInsert=r.rbDelete=r.rightRotate=r.leftRotate=r.resetSentinel=r.calculateLF=r.calculateSize=r.righttest=r.leftest=r.SENTINEL=r.NodeColor=r.TreeNode=void 0;class B{constructor(a,e){this.piece=a,this.color=e,this.size_left=0,this.lf_left=0,this.parent=this,this.left=this,this.right=this}next(){if(this.right!==r.SENTINEL)return P(this.right);let a=this;for(;a.parent!==r.SENTINEL&&a.parent.left!==a;)a=a.parent;return a.parent===r.SENTINEL?r.SENTINEL:a.parent}prev(){if(this.left!==r.SENTINEL)return b(this.left);let a=this;for(;a.parent!==r.SENTINEL&&a.parent.right!==a;)a=a.parent;return a.parent===r.SENTINEL?r.SENTINEL:a.parent}detach(){this.parent=null,this.left=null,this.right=null}}r.TreeNode=B;var U;(function(c){c[c.Black=0]="Black",c[c.Red=1]="Red"})(U=r.NodeColor||(r.NodeColor={})),r.SENTINEL=new B(null,0),r.SENTINEL.parent=r.SENTINEL,r.SENTINEL.left=r.SENTINEL,r.SENTINEL.right=r.SENTINEL,r.SENTINEL.color=0;function P(c){for(;c.left!==r.SENTINEL;)c=c.left;return c}r.leftest=P;function b(c){for(;c.right!==r.SENTINEL;)c=c.right;return c}r.righttest=b;function O(c){return c===r.SENTINEL?0:c.size_left+c.piece.length+O(c.right)}r.calculateSize=O;function D(c){return c===r.SENTINEL?0:c.lf_left+c.piece.lineFeedCnt+D(c.right)}r.calculateLF=D;function R(){r.SENTINEL.parent=r.SENTINEL}r.resetSentinel=R;function m(c,a){const e=a.right;e.size_left+=a.size_left+(a.piece?a.piece.length:0),e.lf_left+=a.lf_left+(a.piece?a.piece.lineFeedCnt:0),a.right=e.left,e.left!==r.SENTINEL&&(e.left.parent=a),e.parent=a.parent,a.parent===r.SENTINEL?c.root=e:a.parent.left===a?a.parent.left=e:a.parent.right=e,e.left=a,a.parent=e}r.leftRotate=m;function _(c,a){const e=a.left;a.left=e.right,e.right!==r.SENTINEL&&(e.right.parent=a),e.parent=a.parent,a.size_left-=e.size_left+(e.piece?e.piece.length:0),a.lf_left-=e.lf_left+(e.piece?e.piece.lineFeedCnt:0),a.parent===r.SENTINEL?c.root=e:a===a.parent.right?a.parent.right=e:a.parent.left=e,e.right=a,a.parent=e}r.rightRotate=_;function I(c,a){let e,i;if(a.left===r.SENTINEL?(i=a,e=i.right):a.right===r.SENTINEL?(i=a,e=i.left):(i=P(a.right),e=i.right),i===c.root){c.root=e,e.color=0,a.detach(),R(),c.root.parent=r.SENTINEL;return}const n=i.color===1;if(i===i.parent.left?i.parent.left=e:i.parent.right=e,i===a?(e.parent=i.parent,v(c,e)):(i.parent===a?e.parent=i:e.parent=i.parent,v(c,e),i.left=a.left,i.right=a.right,i.parent=a.parent,i.color=a.color,a===c.root?c.root=i:a===a.parent.left?a.parent.left=i:a.parent.right=i,i.left!==r.SENTINEL&&(i.left.parent=i),i.right!==r.SENTINEL&&(i.right.parent=i),i.size_left=a.size_left,i.lf_left=a.lf_left,v(c,i)),a.detach(),e.parent.left===e){const l=O(e),o=D(e);if(l!==e.parent.size_left||o!==e.parent.lf_left){const L=l-e.parent.size_left,C=o-e.parent.lf_left;e.parent.size_left=l,e.parent.lf_left=o,N(c,e.parent,L,C)}}if(v(c,e.parent),n){R();return}let s;for(;e!==c.root&&e.color===0;)e===e.parent.left?(s=e.parent.right,s.color===1&&(s.color=0,e.parent.color=1,m(c,e.parent),s=e.parent.right),s.left.color===0&&s.right.color===0?(s.color=1,e=e.parent):(s.right.color===0&&(s.left.color=0,s.color=1,_(c,s),s=e.parent.right),s.color=e.parent.color,e.parent.color=0,s.right.color=0,m(c,e.parent),e=c.root)):(s=e.parent.left,s.color===1&&(s.color=0,e.parent.color=1,_(c,e.parent),s=e.parent.left),s.left.color===0&&s.right.color===0?(s.color=1,e=e.parent):(s.left.color===0&&(s.right.color=0,s.color=1,m(c,s),s=e.parent.left),s.color=e.parent.color,e.parent.color=0,s.left.color=0,_(c,e.parent),e=c.root));e.color=0,R()}r.rbDelete=I;function h(c,a){for(v(c,a);a!==c.root&&a.parent.color===1;)if(a.parent===a.parent.parent.left){const e=a.parent.parent.right;e.color===1?(a.parent.color=0,e.color=0,a.parent.parent.color=1,a=a.parent.parent):(a===a.parent.right&&(a=a.parent,m(c,a)),a.parent.color=0,a.parent.parent.color=1,_(c,a.parent.parent))}else{const e=a.parent.parent.left;e.color===1?(a.parent.color=0,e.color=0,a.parent.parent.color=1,a=a.parent.parent):(a===a.parent.left&&(a=a.parent,_(c,a)),a.parent.color=0,a.parent.parent.color=1,m(c,a.parent.parent))}c.root.color=0}r.fixInsert=h;function N(c,a,e,i){for(;a!==c.root&&a!==r.SENTINEL;)a.parent.left===a&&(a.parent.size_left+=e,a.parent.lf_left+=i),a=a.parent}r.updateTreeMetadata=N;function v(c,a){let e=0,i=0;if(a!==c.root){for(;a!==c.root&&a===a.parent.right;)a=a.parent;if(a!==c.root)for(a=a.parent,e=O(a.left)-a.size_left,i=D(a.left)-a.lf_left,a.size_left+=e,a.lf_left+=i;a!==c.root&&(e!==0||i!==0);)a.parent.left===a&&(a.parent.size_left+=e,a.parent.lf_left+=i),a=a.parent}}r.recomputeTreeMetadata=v}),define(W[5],$([0,1,22,6,15,14,23]),function(z,r,B,U,P,b,O){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PieceTreeBase=r.StringBuffer=r.Piece=r.createLineStarts=r.createLineStartsFast=r.LineStarts=r.createUintArray=r.AverageBufferSize=void 0,r.AverageBufferSize=65535;function D(a){let e;return a[a.length-1]<65536?e=new Uint16Array(a.length):e=new Uint32Array(a.length),e.set(a,0),e}r.createUintArray=D;class R{constructor(e,i,n,s,l){this.lineStarts=e,this.cr=i,this.lf=n,this.crlf=s,this.isBasicASCII=l}}r.LineStarts=R;function m(a,e=!0){const i=[0];let n=1;for(let s=0,l=a.length;s<l;s++){const o=a.charCodeAt(s);o===13?s+1<l&&a.charCodeAt(s+1)===10?(i[n++]=s+2,s++):i[n++]=s+1:o===10&&(i[n++]=s+1)}return e?D(i):i}r.createLineStartsFast=m;function _(a,e){a.length=0,a[0]=0;let i=1,n=0,s=0,l=0,o=!0;for(let C=0,T=e.length;C<T;C++){const E=e.charCodeAt(C);E===13?C+1<T&&e.charCodeAt(C+1)===10?(l++,a[i++]=C+2,C++):(n++,a[i++]=C+1):E===10?(s++,a[i++]=C+1):o&&E!==9&&(E<32||E>126)&&(o=!1)}const L=new R(D(a),n,s,l,o);return a.length=0,L}r.createLineStarts=_;class I{constructor(e,i,n,s,l){this.bufferIndex=e,this.start=i,this.end=n,this.lineFeedCnt=s,this.length=l}}r.Piece=I;class h{constructor(e,i){this.buffer=e,this.lineStarts=i}}r.StringBuffer=h;class N{constructor(e,i){this._pieces=[],this._tree=e,this._BOM=i,this._index=0,e.root!==b.SENTINEL&&e.iterate(e.root,n=>(n!==b.SENTINEL&&this._pieces.push(n.piece),!0))}read(){return this._pieces.length===0?this._index===0?(this._index++,this._BOM):null:this._index>this._pieces.length-1?null:this._index===0?this._BOM+this._tree.getPieceContent(this._pieces[this._index++]):this._tree.getPieceContent(this._pieces[this._index++])}}class v{constructor(e){this._limit=e,this._cache=[]}get(e){for(let i=this._cache.length-1;i>=0;i--){const n=this._cache[i];if(n.nodeStartOffset<=e&&n.nodeStartOffset+n.node.piece.length>=e)return n}return null}get2(e){for(let i=this._cache.length-1;i>=0;i--){const n=this._cache[i];if(n.nodeStartLineNumber&&n.nodeStartLineNumber<e&&n.nodeStartLineNumber+n.node.piece.lineFeedCnt>=e)return n}return null}set(e){this._cache.length>=this._limit&&this._cache.shift(),this._cache.push(e)}validate(e){let i=!1;const n=this._cache;for(let s=0;s<n.length;s++){const l=n[s];if(l.node.parent===null||l.nodeStartOffset>=e){n[s]=null,i=!0;continue}}if(i){const s=[];for(const l of n)l!==null&&s.push(l);this._cache=s}}}class c{constructor(e,i,n){this.create(e,i,n)}create(e,i,n){this._buffers=[new h("",[0])],this._lastChangeBufferPos={line:0,column:0},this.root=b.SENTINEL,this._lineCnt=1,this._length=0,this._EOL=i,this._EOLLength=i.length,this._EOLNormalized=n;let s=null;for(let l=0,o=e.length;l<o;l++)if(e[l].buffer.length>0){e[l].lineStarts||(e[l].lineStarts=m(e[l].buffer));const L=new I(l+1,{line:0,column:0},{line:e[l].lineStarts.length-1,column:e[l].buffer.length-e[l].lineStarts[e[l].lineStarts.length-1]},e[l].lineStarts.length-1,e[l].buffer.length);this._buffers.push(e[l]),s=this.rbInsertRight(s,L)}this._searchCache=new v(1),this._lastVisitedLine={lineNumber:0,value:""},this.computeBufferMetadata()}normalizeEOL(e){const i=r.AverageBufferSize,n=i-Math.floor(i/3),s=n*2;let l="",o=0;const L=[];if(this.iterate(this.root,C=>{const T=this.getNodeContent(C),E=T.length;if(o<=n||o+E<s)return l+=T,o+=E,!0;const S=l.replace(/\r\n|\r|\n/g,e);return L.push(new h(S,m(S))),l=T,o=E,!0}),o>0){const C=l.replace(/\r\n|\r|\n/g,e);L.push(new h(C,m(C)))}this.create(L,e,!0)}getEOL(){return this._EOL}setEOL(e){this._EOL=e,this._EOLLength=this._EOL.length,this.normalizeEOL(e)}createSnapshot(e){return new N(this,e)}equal(e){if(this.getLength()!==e.getLength()||this.getLineCount()!==e.getLineCount())return!1;const i=0;return this.iterate(this.root,s=>{if(s===b.SENTINEL)return!0;const l=this.getNodeContent(s),o=l.length,L=e.nodeAt(i),C=e.nodeAt(i+o),T=e.getValueInRange2(L,C);return l===T})}getOffsetAt(e,i){let n=0,s=this.root;for(;s!==b.SENTINEL;)if(s.left!==b.SENTINEL&&s.lf_left+1>=e)s=s.left;else{if(s.lf_left+s.piece.lineFeedCnt+1>=e)return n+=s.size_left,n+=this.getAccumulatedValue(s,e-s.lf_left-2)+i-1;e-=s.lf_left+s.piece.lineFeedCnt,n+=s.size_left+s.piece.length,s=s.right}return n}getPositionAt(e){e=Math.floor(e),e=Math.max(0,e);let i=this.root,n=0;const s=e;for(;i!==b.SENTINEL;)if(i.size_left!==0&&i.size_left>=e)i=i.left;else if(i.size_left+i.piece.length>=e){const l=this.getIndexOf(i,e-i.size_left);if(n+=i.lf_left+l.index,l.index===0){const o=this.getOffsetAt(n+1,1),L=s-o;return new B.Position(n+1,L+1)}return new B.Position(n+1,l.remainder+1)}else if(e-=i.size_left+i.piece.length,n+=i.lf_left+i.piece.lineFeedCnt,i.right===b.SENTINEL){const l=this.getOffsetAt(n+1,1),o=s-e-l;return new B.Position(n+1,o+1)}else i=i.right;return new B.Position(1,1)}getValueInRange(e,i){if(e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn)return"";const n=this.nodeAt2(e.startLineNumber,e.startColumn),s=this.nodeAt2(e.endLineNumber,e.endColumn),l=this.getValueInRange2(n,s);return i?i!==this._EOL||!this._EOLNormalized?l.replace(/\r\n|\r|\n/g,i):i===this.getEOL()&&this._EOLNormalized?l:l.replace(/\r\n|\r|\n/g,i):l}getValueInRange2(e,i){if(e.node===i.node){const L=e.node,C=this._buffers[L.piece.bufferIndex].buffer,T=this.offsetInBuffer(L.piece.bufferIndex,L.piece.start);return C.substring(T+e.remainder,T+i.remainder)}let n=e.node;const s=this._buffers[n.piece.bufferIndex].buffer,l=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);let o=s.substring(l+e.remainder,l+n.piece.length);for(n=n.next();n!==b.SENTINEL;){const L=this._buffers[n.piece.bufferIndex].buffer,C=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);if(n===i.node){o+=L.substring(C,C+i.remainder);break}else o+=L.substr(C,n.piece.length);n=n.next()}return o}getLinesContent(){const e=[];let i=0,n="",s=!1;return this.iterate(this.root,l=>{if(l===b.SENTINEL)return!0;const o=l.piece;let L=o.length;if(L===0)return!0;const C=this._buffers[o.bufferIndex].buffer,T=this._buffers[o.bufferIndex].lineStarts,E=o.start.line,S=o.end.line;let p=T[E]+o.start.column;if(s&&(C.charCodeAt(p)===10&&(p++,L--),e[i++]=n,n="",s=!1,L===0))return!0;if(E===S)return!this._EOLNormalized&&C.charCodeAt(p+L-1)===13?(s=!0,n+=C.substr(p,L-1)):n+=C.substr(p,L),!0;n+=this._EOLNormalized?C.substring(p,Math.max(p,T[E+1]-this._EOLLength)):C.substring(p,T[E+1]).replace(/(\r\n|\r|\n)$/,""),e[i++]=n;for(let f=E+1;f<S;f++)n=this._EOLNormalized?C.substring(T[f],T[f+1]-this._EOLLength):C.substring(T[f],T[f+1]).replace(/(\r\n|\r|\n)$/,""),e[i++]=n;return!this._EOLNormalized&&C.charCodeAt(T[S]+o.end.column-1)===13?(s=!0,o.end.column===0?i--:n=C.substr(T[S],o.end.column-1)):n=C.substr(T[S],o.end.column),!0}),s&&(e[i++]=n,n=""),e[i++]=n,e}getLength(){return this._length}getLineCount(){return this._lineCnt}getLineContent(e){return this._lastVisitedLine.lineNumber===e?this._lastVisitedLine.value:(this._lastVisitedLine.lineNumber=e,e===this._lineCnt?this._lastVisitedLine.value=this.getLineRawContent(e):this._EOLNormalized?this._lastVisitedLine.value=this.getLineRawContent(e,this._EOLLength):this._lastVisitedLine.value=this.getLineRawContent(e).replace(/(\r\n|\r|\n)$/,""),this._lastVisitedLine.value)}_getCharCode(e){if(e.remainder===e.node.piece.length){const i=e.node.next();if(!i)return 0;const n=this._buffers[i.piece.bufferIndex],s=this.offsetInBuffer(i.piece.bufferIndex,i.piece.start);return n.buffer.charCodeAt(s)}else{const i=this._buffers[e.node.piece.bufferIndex],s=this.offsetInBuffer(e.node.piece.bufferIndex,e.node.piece.start)+e.remainder;return i.buffer.charCodeAt(s)}}getLineCharCode(e,i){const n=this.nodeAt2(e,i+1);return this._getCharCode(n)}getLineLength(e){if(e===this.getLineCount()){const i=this.getOffsetAt(e,1);return this.getLength()-i}return this.getOffsetAt(e+1,1)-this.getOffsetAt(e,1)-this._EOLLength}getCharCode(e){const i=this.nodeAt(e);return this._getCharCode(i)}findMatchesInNode(e,i,n,s,l,o,L,C,T,E,S){const p=this._buffers[e.piece.bufferIndex],f=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start),y=this.offsetInBuffer(e.piece.bufferIndex,l),d=this.offsetInBuffer(e.piece.bufferIndex,o);let k;const M={line:0,column:0};let w,t;i._wordSeparators?(w=p.buffer.substring(y,d),t=u=>u+y,i.reset(0)):(w=p.buffer,t=u=>u,i.reset(y));do if(k=i.next(w),k){if(t(k.index)>=d)return E;this.positionInBuffer(e,t(k.index)-f,M);const u=this.getLineFeedCnt(e.piece.bufferIndex,l,M),g=M.line===l.line?M.column-l.column+s:M.column+1,A=g+k[0].length;if(S[E++]=(0,O.createFindMatch)(new U.Range(n+u,g,n+u,A),k,C),t(k.index)+k[0].length>=d||E>=T)return E}while(k);return E}findMatchesLineByLine(e,i,n,s){const l=[];let o=0;const L=new O.Searcher(i.wordSeparators,i.regex);let C=this.nodeAt2(e.startLineNumber,e.startColumn);if(C===null)return[];const T=this.nodeAt2(e.endLineNumber,e.endColumn);if(T===null)return[];let E=this.positionInBuffer(C.node,C.remainder);const S=this.positionInBuffer(T.node,T.remainder);if(C.node===T.node)return this.findMatchesInNode(C.node,L,e.startLineNumber,e.startColumn,E,S,i,n,s,o,l),l;let p=e.startLineNumber,f=C.node;for(;f!==T.node;){const d=this.getLineFeedCnt(f.piece.bufferIndex,E,f.piece.end);if(d>=1){const M=this._buffers[f.piece.bufferIndex].lineStarts,w=this.offsetInBuffer(f.piece.bufferIndex,f.piece.start),t=M[E.line+d],u=p===e.startLineNumber?e.startColumn:1;if(o=this.findMatchesInNode(f,L,p,u,E,this.positionInBuffer(f,t-w),i,n,s,o,l),o>=s)return l;p+=d}const k=p===e.startLineNumber?e.startColumn-1:0;if(p===e.endLineNumber){const M=this.getLineContent(p).substring(k,e.endColumn-1);return o=this._findMatchesInLine(i,L,M,e.endLineNumber,k,o,l,n,s),l}if(o=this._findMatchesInLine(i,L,this.getLineContent(p).substr(k),p,k,o,l,n,s),o>=s)return l;p++,C=this.nodeAt2(p,1),f=C.node,E=this.positionInBuffer(C.node,C.remainder)}if(p===e.endLineNumber){const d=p===e.startLineNumber?e.startColumn-1:0,k=this.getLineContent(p).substring(d,e.endColumn-1);return o=this._findMatchesInLine(i,L,k,e.endLineNumber,d,o,l,n,s),l}const y=p===e.startLineNumber?e.startColumn:1;return o=this.findMatchesInNode(T.node,L,p,y,E,S,i,n,s,o,l),l}_findMatchesInLine(e,i,n,s,l,o,L,C,T){const E=e.wordSeparators;if(!C&&e.simpleSearch){const p=e.simpleSearch,f=p.length,y=n.length;let d=-f;for(;(d=n.indexOf(p,d+f))!==-1;)if((!E||(0,O.isValidMatch)(E,n,y,d,f))&&(L[o++]=new P.FindMatch(new U.Range(s,d+1+l,s,d+1+f+l),null),o>=T))return o;return o}let S;i.reset(0);do if(S=i.next(n),S&&(L[o++]=(0,O.createFindMatch)(new U.Range(s,S.index+1+l,s,S.index+1+S[0].length+l),S,C),o>=T))return o;while(S);return o}insert(e,i,n=!1){if(this._EOLNormalized=this._EOLNormalized&&n,this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",this.root!==b.SENTINEL){const{node:s,remainder:l,nodeStartOffset:o}=this.nodeAt(e),L=s.piece,C=L.bufferIndex,T=this.positionInBuffer(s,l);if(s.piece.bufferIndex===0&&L.end.line===this._lastChangeBufferPos.line&&L.end.column===this._lastChangeBufferPos.column&&o+L.length===e&&i.length<r.AverageBufferSize){this.appendToNode(s,i),this.computeBufferMetadata();return}if(o===e)this.insertContentToNodeLeft(i,s),this._searchCache.validate(e);else if(o+s.piece.length>e){const E=[];let S=new I(L.bufferIndex,T,L.end,this.getLineFeedCnt(L.bufferIndex,T,L.end),this.offsetInBuffer(C,L.end)-this.offsetInBuffer(C,T));if(this.shouldCheckCRLF()&&this.endWithCR(i)&&this.nodeCharCodeAt(s,l)===10){const d={line:S.start.line+1,column:0};S=new I(S.bufferIndex,d,S.end,this.getLineFeedCnt(S.bufferIndex,d,S.end),S.length-1),i+=`
`}if(this.shouldCheckCRLF()&&this.startWithLF(i))if(this.nodeCharCodeAt(s,l-1)===13){const d=this.positionInBuffer(s,l-1);this.deleteNodeTail(s,d),i="\r"+i,s.piece.length===0&&E.push(s)}else this.deleteNodeTail(s,T);else this.deleteNodeTail(s,T);const p=this.createNewPieces(i);S.length>0&&this.rbInsertRight(s,S);let f=s;for(let y=0;y<p.length;y++)f=this.rbInsertRight(f,p[y]);this.deleteNodes(E)}else this.insertContentToNodeRight(i,s)}else{const s=this.createNewPieces(i);let l=this.rbInsertLeft(null,s[0]);for(let o=1;o<s.length;o++)l=this.rbInsertRight(l,s[o])}this.computeBufferMetadata()}delete(e,i){if(this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",i<=0||this.root===b.SENTINEL)return;const n=this.nodeAt(e),s=this.nodeAt(e+i),l=n.node,o=s.node;if(l===o){const p=this.positionInBuffer(l,n.remainder),f=this.positionInBuffer(l,s.remainder);if(n.nodeStartOffset===e){if(i===l.piece.length){const y=l.next();(0,b.rbDelete)(this,l),this.validateCRLFWithPrevNode(y),this.computeBufferMetadata();return}this.deleteNodeHead(l,f),this._searchCache.validate(e),this.validateCRLFWithPrevNode(l),this.computeBufferMetadata();return}if(n.nodeStartOffset+l.piece.length===e+i){this.deleteNodeTail(l,p),this.validateCRLFWithNextNode(l),this.computeBufferMetadata();return}this.shrinkNode(l,p,f),this.computeBufferMetadata();return}const L=[],C=this.positionInBuffer(l,n.remainder);this.deleteNodeTail(l,C),this._searchCache.validate(e),l.piece.length===0&&L.push(l);const T=this.positionInBuffer(o,s.remainder);this.deleteNodeHead(o,T),o.piece.length===0&&L.push(o);const E=l.next();for(let p=E;p!==b.SENTINEL&&p!==o;p=p.next())L.push(p);const S=l.piece.length===0?l.prev():l;this.deleteNodes(L),this.validateCRLFWithNextNode(S),this.computeBufferMetadata()}insertContentToNodeLeft(e,i){const n=[];if(this.shouldCheckCRLF()&&this.endWithCR(e)&&this.startWithLF(i)){const o=i.piece,L={line:o.start.line+1,column:0},C=new I(o.bufferIndex,L,o.end,this.getLineFeedCnt(o.bufferIndex,L,o.end),o.length-1);i.piece=C,e+=`
`,(0,b.updateTreeMetadata)(this,i,-1,-1),i.piece.length===0&&n.push(i)}const s=this.createNewPieces(e);let l=this.rbInsertLeft(i,s[s.length-1]);for(let o=s.length-2;o>=0;o--)l=this.rbInsertLeft(l,s[o]);this.validateCRLFWithPrevNode(l),this.deleteNodes(n)}insertContentToNodeRight(e,i){this.adjustCarriageReturnFromNext(e,i)&&(e+=`
`);const n=this.createNewPieces(e),s=this.rbInsertRight(i,n[0]);let l=s;for(let o=1;o<n.length;o++)l=this.rbInsertRight(l,n[o]);this.validateCRLFWithPrevNode(s)}positionInBuffer(e,i,n){const s=e.piece,l=e.piece.bufferIndex,o=this._buffers[l].lineStarts,C=o[s.start.line]+s.start.column+i;let T=s.start.line,E=s.end.line,S=0,p=0,f=0;for(;T<=E&&(S=T+(E-T)/2|0,f=o[S],S!==E);)if(p=o[S+1],C<f)E=S-1;else if(C>=p)T=S+1;else break;return n?(n.line=S,n.column=C-f,null):{line:S,column:C-f}}getLineFeedCnt(e,i,n){if(n.column===0)return n.line-i.line;const s=this._buffers[e].lineStarts;if(n.line===s.length-1)return n.line-i.line;const l=s[n.line+1],o=s[n.line]+n.column;if(l>o+1)return n.line-i.line;const L=o-1;return this._buffers[e].buffer.charCodeAt(L)===13?n.line-i.line+1:n.line-i.line}offsetInBuffer(e,i){return this._buffers[e].lineStarts[i.line]+i.column}deleteNodes(e){for(let i=0;i<e.length;i++)(0,b.rbDelete)(this,e[i])}createNewPieces(e){if(e.length>r.AverageBufferSize){const E=[];for(;e.length>r.AverageBufferSize;){const p=e.charCodeAt(r.AverageBufferSize-1);let f;p===13||p>=55296&&p<=56319?(f=e.substring(0,r.AverageBufferSize-1),e=e.substring(r.AverageBufferSize-1)):(f=e.substring(0,r.AverageBufferSize),e=e.substring(r.AverageBufferSize));const y=m(f);E.push(new I(this._buffers.length,{line:0,column:0},{line:y.length-1,column:f.length-y[y.length-1]},y.length-1,f.length)),this._buffers.push(new h(f,y))}const S=m(e);return E.push(new I(this._buffers.length,{line:0,column:0},{line:S.length-1,column:e.length-S[S.length-1]},S.length-1,e.length)),this._buffers.push(new h(e,S)),E}let i=this._buffers[0].buffer.length;const n=m(e,!1);let s=this._lastChangeBufferPos;if(this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-1]===i&&i!==0&&this.startWithLF(e)&&this.endWithCR(this._buffers[0].buffer)){this._lastChangeBufferPos={line:this._lastChangeBufferPos.line,column:this._lastChangeBufferPos.column+1},s=this._lastChangeBufferPos;for(let E=0;E<n.length;E++)n[E]+=i+1;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(n.slice(1)),this._buffers[0].buffer+="_"+e,i+=1}else{if(i!==0)for(let E=0;E<n.length;E++)n[E]+=i;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(n.slice(1)),this._buffers[0].buffer+=e}const l=this._buffers[0].buffer.length,o=this._buffers[0].lineStarts.length-1,L=l-this._buffers[0].lineStarts[o],C={line:o,column:L},T=new I(0,s,C,this.getLineFeedCnt(0,s,C),l-i);return this._lastChangeBufferPos=C,[T]}getLinesRawContent(){return this.getContentOfSubTree(this.root)}getLineRawContent(e,i=0){let n=this.root,s="";const l=this._searchCache.get2(e);if(l){n=l.node;const o=this.getAccumulatedValue(n,e-l.nodeStartLineNumber-1),L=this._buffers[n.piece.bufferIndex].buffer,C=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);if(l.nodeStartLineNumber+n.piece.lineFeedCnt===e)s=L.substring(C+o,C+n.piece.length);else{const T=this.getAccumulatedValue(n,e-l.nodeStartLineNumber);return L.substring(C+o,C+T-i)}}else{let o=0;const L=e;for(;n!==b.SENTINEL;)if(n.left!==b.SENTINEL&&n.lf_left>=e-1)n=n.left;else if(n.lf_left+n.piece.lineFeedCnt>e-1){const C=this.getAccumulatedValue(n,e-n.lf_left-2),T=this.getAccumulatedValue(n,e-n.lf_left-1),E=this._buffers[n.piece.bufferIndex].buffer,S=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);return o+=n.size_left,this._searchCache.set({node:n,nodeStartOffset:o,nodeStartLineNumber:L-(e-1-n.lf_left)}),E.substring(S+C,S+T-i)}else if(n.lf_left+n.piece.lineFeedCnt===e-1){const C=this.getAccumulatedValue(n,e-n.lf_left-2),T=this._buffers[n.piece.bufferIndex].buffer,E=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);s=T.substring(E+C,E+n.piece.length);break}else e-=n.lf_left+n.piece.lineFeedCnt,o+=n.size_left+n.piece.length,n=n.right}for(n=n.next();n!==b.SENTINEL;){const o=this._buffers[n.piece.bufferIndex].buffer;if(n.piece.lineFeedCnt>0){const L=this.getAccumulatedValue(n,0),C=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);return s+=o.substring(C,C+L-i),s}else{const L=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);s+=o.substr(L,n.piece.length)}n=n.next()}return s}computeBufferMetadata(){let e=this.root,i=1,n=0;for(;e!==b.SENTINEL;)i+=e.lf_left+e.piece.lineFeedCnt,n+=e.size_left+e.piece.length,e=e.right;this._lineCnt=i,this._length=n,this._searchCache.validate(this._length)}getIndexOf(e,i){const n=e.piece,s=this.positionInBuffer(e,i),l=s.line-n.start.line;if(this.offsetInBuffer(n.bufferIndex,n.end)-this.offsetInBuffer(n.bufferIndex,n.start)===i){const o=this.getLineFeedCnt(e.piece.bufferIndex,n.start,s);if(o!==l)return{index:o,remainder:0}}return{index:l,remainder:s.column}}getAccumulatedValue(e,i){if(i<0)return 0;const n=e.piece,s=this._buffers[n.bufferIndex].lineStarts,l=n.start.line+i+1;return l>n.end.line?s[n.end.line]+n.end.column-s[n.start.line]-n.start.column:s[l]-s[n.start.line]-n.start.column}deleteNodeTail(e,i){const n=e.piece,s=n.lineFeedCnt,l=this.offsetInBuffer(n.bufferIndex,n.end),o=i,L=this.offsetInBuffer(n.bufferIndex,o),C=this.getLineFeedCnt(n.bufferIndex,n.start,o),T=C-s,E=L-l,S=n.length+E;e.piece=new I(n.bufferIndex,n.start,o,C,S),(0,b.updateTreeMetadata)(this,e,E,T)}deleteNodeHead(e,i){const n=e.piece,s=n.lineFeedCnt,l=this.offsetInBuffer(n.bufferIndex,n.start),o=i,L=this.getLineFeedCnt(n.bufferIndex,o,n.end),C=this.offsetInBuffer(n.bufferIndex,o),T=L-s,E=l-C,S=n.length+E;e.piece=new I(n.bufferIndex,o,n.end,L,S),(0,b.updateTreeMetadata)(this,e,E,T)}shrinkNode(e,i,n){const s=e.piece,l=s.start,o=s.end,L=s.length,C=s.lineFeedCnt,T=i,E=this.getLineFeedCnt(s.bufferIndex,s.start,T),S=this.offsetInBuffer(s.bufferIndex,i)-this.offsetInBuffer(s.bufferIndex,l);e.piece=new I(s.bufferIndex,s.start,T,E,S),(0,b.updateTreeMetadata)(this,e,S-L,E-C);const p=new I(s.bufferIndex,n,o,this.getLineFeedCnt(s.bufferIndex,n,o),this.offsetInBuffer(s.bufferIndex,o)-this.offsetInBuffer(s.bufferIndex,n)),f=this.rbInsertRight(e,p);this.validateCRLFWithPrevNode(f)}appendToNode(e,i){this.adjustCarriageReturnFromNext(i,e)&&(i+=`
`);const n=this.shouldCheckCRLF()&&this.startWithLF(i)&&this.endWithCR(e),s=this._buffers[0].buffer.length;this._buffers[0].buffer+=i;const l=m(i,!1);for(let f=0;f<l.length;f++)l[f]+=s;if(n){const f=this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-2];this._buffers[0].lineStarts.pop(),this._lastChangeBufferPos={line:this._lastChangeBufferPos.line-1,column:s-f}}this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(l.slice(1));const o=this._buffers[0].lineStarts.length-1,L=this._buffers[0].buffer.length-this._buffers[0].lineStarts[o],C={line:o,column:L},T=e.piece.length+i.length,E=e.piece.lineFeedCnt,S=this.getLineFeedCnt(0,e.piece.start,C),p=S-E;e.piece=new I(e.piece.bufferIndex,e.piece.start,C,S,T),this._lastChangeBufferPos=C,(0,b.updateTreeMetadata)(this,e,i.length,p)}nodeAt(e){let i=this.root;const n=this._searchCache.get(e);if(n)return{node:n.node,nodeStartOffset:n.nodeStartOffset,remainder:e-n.nodeStartOffset};let s=0;for(;i!==b.SENTINEL;)if(i.size_left>e)i=i.left;else if(i.size_left+i.piece.length>=e){s+=i.size_left;const l={node:i,remainder:e-i.size_left,nodeStartOffset:s};return this._searchCache.set(l),l}else e-=i.size_left+i.piece.length,s+=i.size_left+i.piece.length,i=i.right;return null}nodeAt2(e,i){let n=this.root,s=0;for(;n!==b.SENTINEL;)if(n.left!==b.SENTINEL&&n.lf_left>=e-1)n=n.left;else if(n.lf_left+n.piece.lineFeedCnt>e-1){const l=this.getAccumulatedValue(n,e-n.lf_left-2),o=this.getAccumulatedValue(n,e-n.lf_left-1);return s+=n.size_left,{node:n,remainder:Math.min(l+i-1,o),nodeStartOffset:s}}else if(n.lf_left+n.piece.lineFeedCnt===e-1){const l=this.getAccumulatedValue(n,e-n.lf_left-2);if(l+i-1<=n.piece.length)return{node:n,remainder:l+i-1,nodeStartOffset:s};i-=n.piece.length-l;break}else e-=n.lf_left+n.piece.lineFeedCnt,s+=n.size_left+n.piece.length,n=n.right;for(n=n.next();n!==b.SENTINEL;){if(n.piece.lineFeedCnt>0){const l=this.getAccumulatedValue(n,0),o=this.offsetOfNode(n);return{node:n,remainder:Math.min(i-1,l),nodeStartOffset:o}}else if(n.piece.length>=i-1){const l=this.offsetOfNode(n);return{node:n,remainder:i-1,nodeStartOffset:l}}else i-=n.piece.length;n=n.next()}return null}nodeCharCodeAt(e,i){if(e.piece.lineFeedCnt<1)return-1;const n=this._buffers[e.piece.bufferIndex],s=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start)+i;return n.buffer.charCodeAt(s)}offsetOfNode(e){if(!e)return 0;let i=e.size_left;for(;e!==this.root;)e.parent.right===e&&(i+=e.parent.size_left+e.parent.piece.length),e=e.parent;return i}shouldCheckCRLF(){return!(this._EOLNormalized&&this._EOL===`
`)}startWithLF(e){if(typeof e=="string")return e.charCodeAt(0)===10;if(e===b.SENTINEL||e.piece.lineFeedCnt===0)return!1;const i=e.piece,n=this._buffers[i.bufferIndex].lineStarts,s=i.start.line,l=n[s]+i.start.column;return s===n.length-1||n[s+1]>l+1?!1:this._buffers[i.bufferIndex].buffer.charCodeAt(l)===10}endWithCR(e){return typeof e=="string"?e.charCodeAt(e.length-1)===13:e===b.SENTINEL||e.piece.lineFeedCnt===0?!1:this.nodeCharCodeAt(e,e.piece.length-1)===13}validateCRLFWithPrevNode(e){if(this.shouldCheckCRLF()&&this.startWithLF(e)){const i=e.prev();this.endWithCR(i)&&this.fixCRLF(i,e)}}validateCRLFWithNextNode(e){if(this.shouldCheckCRLF()&&this.endWithCR(e)){const i=e.next();this.startWithLF(i)&&this.fixCRLF(e,i)}}fixCRLF(e,i){const n=[],s=this._buffers[e.piece.bufferIndex].lineStarts;let l;e.piece.end.column===0?l={line:e.piece.end.line-1,column:s[e.piece.end.line]-s[e.piece.end.line-1]-1}:l={line:e.piece.end.line,column:e.piece.end.column-1};const o=e.piece.length-1,L=e.piece.lineFeedCnt-1;e.piece=new I(e.piece.bufferIndex,e.piece.start,l,L,o),(0,b.updateTreeMetadata)(this,e,-1,-1),e.piece.length===0&&n.push(e);const C={line:i.piece.start.line+1,column:0},T=i.piece.length-1,E=this.getLineFeedCnt(i.piece.bufferIndex,C,i.piece.end);i.piece=new I(i.piece.bufferIndex,C,i.piece.end,E,T),(0,b.updateTreeMetadata)(this,i,-1,-1),i.piece.length===0&&n.push(i);const S=this.createNewPieces(`\r
`);this.rbInsertRight(e,S[0]);for(let p=0;p<n.length;p++)(0,b.rbDelete)(this,n[p])}adjustCarriageReturnFromNext(e,i){if(this.shouldCheckCRLF()&&this.endWithCR(e)){const n=i.next();if(this.startWithLF(n)){if(e+=`
`,n.piece.length===1)(0,b.rbDelete)(this,n);else{const s=n.piece,l={line:s.start.line+1,column:0},o=s.length-1,L=this.getLineFeedCnt(s.bufferIndex,l,s.end);n.piece=new I(s.bufferIndex,l,s.end,L,o),(0,b.updateTreeMetadata)(this,n,-1,-1)}return!0}}return!1}iterate(e,i){if(e===b.SENTINEL)return i(b.SENTINEL);const n=this.iterate(e.left,i);return n&&i(e)&&this.iterate(e.right,i)}getNodeContent(e){if(e===b.SENTINEL)return"";const i=this._buffers[e.piece.bufferIndex];let n;const s=e.piece,l=this.offsetInBuffer(s.bufferIndex,s.start),o=this.offsetInBuffer(s.bufferIndex,s.end);return n=i.buffer.substring(l,o),n}getPieceContent(e){const i=this._buffers[e.bufferIndex],n=this.offsetInBuffer(e.bufferIndex,e.start),s=this.offsetInBuffer(e.bufferIndex,e.end);return i.buffer.substring(n,s)}rbInsertRight(e,i){const n=new b.TreeNode(i,1);if(n.left=b.SENTINEL,n.right=b.SENTINEL,n.parent=b.SENTINEL,n.size_left=0,n.lf_left=0,this.root===b.SENTINEL)this.root=n,n.color=0;else if(e.right===b.SENTINEL)e.right=n,n.parent=e;else{const l=(0,b.leftest)(e.right);l.left=n,n.parent=l}return(0,b.fixInsert)(this,n),n}rbInsertLeft(e,i){const n=new b.TreeNode(i,1);if(n.left=b.SENTINEL,n.right=b.SENTINEL,n.parent=b.SENTINEL,n.size_left=0,n.lf_left=0,this.root===b.SENTINEL)this.root=n,n.color=0;else if(e.left===b.SENTINEL)e.left=n,n.parent=e;else{const s=(0,b.righttest)(e.left);s.right=n,n.parent=s}return(0,b.fixInsert)(this,n),n}getContentOfSubTree(e){let i="";return this.iterate(e,n=>(i+=this.getNodeContent(n),!0)),i}}r.PieceTreeBase=c}),define(W[16],$([0,1,24,2,6,15,5,11,13,10]),function(z,r,B,U,P,b,O,D,R,m){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PieceTreeTextBuffer=void 0;class _ extends m.Disposable{constructor(h,N,v,c,a,e,i){super();this._onDidChangeContent=this._register(new B.Emitter),this.onDidChangeContent=this._onDidChangeContent.event,this._BOM=N,this._mightContainNonBasicASCII=!e,this._mightContainRTL=c,this._mightContainUnusualLineTerminators=a,this._pieceTree=new O.PieceTreeBase(h,v,i)}equals(h){return!(h instanceof _)||this._BOM!==h._BOM||this.getEOL()!==h.getEOL()?!1:this._pieceTree.equal(h._pieceTree)}mightContainRTL(){return this._mightContainRTL}mightContainUnusualLineTerminators(){return this._mightContainUnusualLineTerminators}resetMightContainUnusualLineTerminators(){this._mightContainUnusualLineTerminators=!1}mightContainNonBasicASCII(){return this._mightContainNonBasicASCII}getBOM(){return this._BOM}getEOL(){return this._pieceTree.getEOL()}createSnapshot(h){return this._pieceTree.createSnapshot(h?this._BOM:"")}getOffsetAt(h,N){return this._pieceTree.getOffsetAt(h,N)}getPositionAt(h){return this._pieceTree.getPositionAt(h)}getRangeAt(h,N){const v=h+N,c=this.getPositionAt(h),a=this.getPositionAt(v);return new P.Range(c.lineNumber,c.column,a.lineNumber,a.column)}getValueInRange(h,N=0){if(h.isEmpty())return"";const v=this._getEndOfLine(N);return this._pieceTree.getValueInRange(h,v)}getValueLengthInRange(h,N=0){if(h.isEmpty())return 0;if(h.startLineNumber===h.endLineNumber)return h.endColumn-h.startColumn;const v=this.getOffsetAt(h.startLineNumber,h.startColumn);return this.getOffsetAt(h.endLineNumber,h.endColumn)-v}getCharacterCountInRange(h,N=0){if(this._mightContainNonBasicASCII){let v=0;const c=h.startLineNumber,a=h.endLineNumber;for(let e=c;e<=a;e++){const i=this.getLineContent(e),n=e===c?h.startColumn-1:0,s=e===a?h.endColumn-1:i.length;for(let l=n;l<s;l++)U.isHighSurrogate(i.charCodeAt(l))?(v=v+1,l=l+1):v=v+1}return v+=this._getEndOfLine(N).length*(a-c),v}return this.getValueLengthInRange(h,N)}getLength(){return this._pieceTree.getLength()}getLineCount(){return this._pieceTree.getLineCount()}getLinesContent(){return this._pieceTree.getLinesContent()}getLineContent(h){return this._pieceTree.getLineContent(h)}getLineCharCode(h,N){return this._pieceTree.getLineCharCode(h,N)}getCharCode(h){return this._pieceTree.getCharCode(h)}getLineLength(h){return this._pieceTree.getLineLength(h)}getLineMinColumn(h){return 1}getLineMaxColumn(h){return this.getLineLength(h)+1}getLineFirstNonWhitespaceColumn(h){const N=U.firstNonWhitespaceIndex(this.getLineContent(h));return N===-1?0:N+1}getLineLastNonWhitespaceColumn(h){const N=U.lastNonWhitespaceIndex(this.getLineContent(h));return N===-1?0:N+2}_getEndOfLine(h){switch(h){case 1:return`
`;case 2:return`\r
`;case 0:return this.getEOL();default:throw new Error("Unknown EOL preference")}}setEOL(h){this._pieceTree.setEOL(h)}applyEdits(h,N,v){let c=this._mightContainRTL,a=this._mightContainUnusualLineTerminators,e=this._mightContainNonBasicASCII,i=!0,n=[];for(let E=0;E<h.length;E++){const S=h[E];i&&S._isTracked&&(i=!1);const p=S.range;if(S.text){let M=!0;e||(M=!U.isBasicASCII(S.text),e=M),!c&&M&&(c=U.containsRTL(S.text)),!a&&M&&(a=U.containsUnusualLineTerminators(S.text))}let f="",y=0,d=0,k=0;if(S.text){let M;[y,d,k,M]=(0,D.countEOL)(S.text);const w=this.getEOL();M===0||M===(w===`\r
`?2:1)?f=S.text:f=S.text.replace(/\r\n|\r|\n/g,w)}n[E]={sortIndex:E,identifier:S.identifier||null,range:p,rangeOffset:this.getOffsetAt(p.startLineNumber,p.startColumn),rangeLength:this.getValueLengthInRange(p),text:f,eolCount:y,firstLineLength:d,lastLineLength:k,forceMoveMarkers:Boolean(S.forceMoveMarkers),isAutoWhitespaceEdit:S.isAutoWhitespaceEdit||!1}}n.sort(_._sortOpsAscending);let s=!1;for(let E=0,S=n.length-1;E<S;E++){const p=n[E].range.getEndPosition(),f=n[E+1].range.getStartPosition();if(f.isBeforeOrEqual(p)){if(f.isBefore(p))throw new Error("Overlapping ranges are not allowed!");s=!0}}i&&(n=this._reduceOperations(n));const l=v||N?_._getInverseEditRanges(n):[],o=[];if(N)for(let E=0;E<n.length;E++){const S=n[E],p=l[E];if(S.isAutoWhitespaceEdit&&S.range.isEmpty())for(let f=p.startLineNumber;f<=p.endLineNumber;f++){let y="";f===p.startLineNumber&&(y=this.getLineContent(S.range.startLineNumber),U.firstNonWhitespaceIndex(y)!==-1)||o.push({lineNumber:f,oldContent:y})}}let L=null;if(v){let E=0;L=[];for(let S=0;S<n.length;S++){const p=n[S],f=l[S],y=this.getValueInRange(p.range),d=p.rangeOffset+E;E+=p.text.length-y.length,L[S]={sortIndex:p.sortIndex,identifier:p.identifier,range:f,text:y,textChange:new R.TextChange(p.rangeOffset,y,d,p.text)}}s||L.sort((S,p)=>S.sortIndex-p.sortIndex)}this._mightContainRTL=c,this._mightContainUnusualLineTerminators=a,this._mightContainNonBasicASCII=e;const C=this._doApplyEdits(n);let T=null;if(N&&o.length>0){o.sort((E,S)=>S.lineNumber-E.lineNumber),T=[];for(let E=0,S=o.length;E<S;E++){const p=o[E].lineNumber;if(E>0&&o[E-1].lineNumber===p)continue;const f=o[E].oldContent,y=this.getLineContent(p);y.length===0||y===f||U.firstNonWhitespaceIndex(y)!==-1||T.push(p)}}return this._onDidChangeContent.fire(),new b.ApplyEditsResult(L,C,T)}_reduceOperations(h){return h.length<1e3?h:[this._toSingleEditOperation(h)]}_toSingleEditOperation(h){let N=!1;const v=h[0].range,c=h[h.length-1].range,a=new P.Range(v.startLineNumber,v.startColumn,c.endLineNumber,c.endColumn);let e=v.startLineNumber,i=v.startColumn;const n=[];for(let C=0,T=h.length;C<T;C++){const E=h[C],S=E.range;N=N||E.forceMoveMarkers,n.push(this.getValueInRange(new P.Range(e,i,S.startLineNumber,S.startColumn))),E.text.length>0&&n.push(E.text),e=S.endLineNumber,i=S.endColumn}const s=n.join(""),[l,o,L]=(0,D.countEOL)(s);return{sortIndex:0,identifier:h[0].identifier,range:a,rangeOffset:this.getOffsetAt(a.startLineNumber,a.startColumn),rangeLength:this.getValueLengthInRange(a,0),text:s,eolCount:l,firstLineLength:o,lastLineLength:L,forceMoveMarkers:N,isAutoWhitespaceEdit:!1}}_doApplyEdits(h){h.sort(_._sortOpsDescending);const N=[];for(let v=0;v<h.length;v++){const c=h[v],a=c.range.startLineNumber,e=c.range.startColumn,i=c.range.endLineNumber,n=c.range.endColumn;if(a===i&&e===n&&c.text.length===0)continue;c.text?(this._pieceTree.delete(c.rangeOffset,c.rangeLength),this._pieceTree.insert(c.rangeOffset,c.text,!0)):this._pieceTree.delete(c.rangeOffset,c.rangeLength);const s=new P.Range(a,e,i,n);N.push({range:s,rangeLength:c.rangeLength,text:c.text,rangeOffset:c.rangeOffset,forceMoveMarkers:c.forceMoveMarkers})}return N}findMatchesLineByLine(h,N,v,c){return this._pieceTree.findMatchesLineByLine(h,N,v,c)}getPieceTree(){return this._pieceTree}static _getInverseEditRange(h,N){const v=h.startLineNumber,c=h.startColumn,[a,e,i]=(0,D.countEOL)(N);let n;if(N.length>0){const s=a+1;s===1?n=new P.Range(v,c,v,c+e):n=new P.Range(v,c,v+s-1,i+1)}else n=new P.Range(v,c,v,c);return n}static _getInverseEditRanges(h){const N=[];let v=0,c=0,a=null;for(let e=0,i=h.length;e<i;e++){const n=h[e];let s,l;a?a.range.endLineNumber===n.range.startLineNumber?(s=v,l=c+(n.range.startColumn-a.range.endColumn)):(s=v+(n.range.startLineNumber-a.range.endLineNumber),l=n.range.startColumn):(s=n.range.startLineNumber,l=n.range.startColumn);let o;if(n.text.length>0){const L=n.eolCount+1;L===1?o=new P.Range(s,l,s,l+n.firstLineLength):o=new P.Range(s,l,s+L-1,n.lastLineLength+1)}else o=new P.Range(s,l,s,l);v=o.endLineNumber,c=o.endColumn,N.push(o),a=n}return N}static _sortOpsAscending(h,N){const v=P.Range.compareRangesUsingEnds(h.range,N.range);return v===0?h.sortIndex-N.sortIndex:v}static _sortOpsDescending(h,N){const v=P.Range.compareRangesUsingEnds(h.range,N.range);return v===0?N.sortIndex-h.sortIndex:-v}}r.PieceTreeTextBuffer=_}),define(W[17],$([0,1,2,5,16]),function(z,r,B,U,P){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PieceTreeTextBufferBuilder=r.PieceTreeTextBufferFactory=void 0;class b{constructor(R,m,_,I,h,N,v,c,a){this._chunks=R,this._bom=m,this._cr=_,this._lf=I,this._crlf=h,this._containsRTL=N,this._containsUnusualLineTerminators=v,this._isBasicASCII=c,this._normalizeEOL=a}_getEOL(R){const m=this._cr+this._lf+this._crlf,_=this._cr+this._crlf;return m===0?R===1?`
`:`\r
`:_>m/2?`\r
`:`
`}create(R){const m=this._getEOL(R),_=this._chunks;if(this._normalizeEOL&&(m===`\r
`&&(this._cr>0||this._lf>0)||m===`
`&&(this._cr>0||this._crlf>0)))for(let h=0,N=_.length;h<N;h++){const v=_[h].buffer.replace(/\r\n|\r|\n/g,m),c=(0,U.createLineStartsFast)(v);_[h]=new U.StringBuffer(v,c)}const I=new P.PieceTreeTextBuffer(_,this._bom,m,this._containsRTL,this._containsUnusualLineTerminators,this._isBasicASCII,this._normalizeEOL);return{textBuffer:I,disposable:I}}getFirstLineText(R){return this._chunks[0].buffer.substr(0,R).split(/\r\n|\r|\n/)[0]}}r.PieceTreeTextBufferFactory=b;class O{constructor(){this.chunks=[],this.BOM="",this._hasPreviousChar=!1,this._previousChar=0,this._tmpLineStarts=[],this.cr=0,this.lf=0,this.crlf=0,this.containsRTL=!1,this.containsUnusualLineTerminators=!1,this.isBasicASCII=!0}acceptChunk(R){if(R.length===0)return;this.chunks.length===0&&B.startsWithUTF8BOM(R)&&(this.BOM=B.UTF8_BOM_CHARACTER,R=R.substr(1));const m=R.charCodeAt(R.length-1);m===13||m>=55296&&m<=56319?(this._acceptChunk1(R.substr(0,R.length-1),!1),this._hasPreviousChar=!0,this._previousChar=m):(this._acceptChunk1(R,!1),this._hasPreviousChar=!1,this._previousChar=m)}_acceptChunk1(R,m){!m&&R.length===0||(this._hasPreviousChar?this._acceptChunk2(String.fromCharCode(this._previousChar)+R):this._acceptChunk2(R))}_acceptChunk2(R){const m=(0,U.createLineStarts)(this._tmpLineStarts,R);this.chunks.push(new U.StringBuffer(R,m.lineStarts)),this.cr+=m.cr,this.lf+=m.lf,this.crlf+=m.crlf,this.isBasicASCII&&(this.isBasicASCII=m.isBasicASCII),!this.isBasicASCII&&!this.containsRTL&&(this.containsRTL=B.containsRTL(R)),!this.isBasicASCII&&!this.containsUnusualLineTerminators&&(this.containsUnusualLineTerminators=B.containsUnusualLineTerminators(R))}finish(R=!0){return this._finish(),new b(this.chunks,this.BOM,this.cr,this.lf,this.crlf,this.containsRTL,this.containsUnusualLineTerminators,this.isBasicASCII,R)}_finish(){if(this.chunks.length===0&&this._acceptChunk1("",!0),this._hasPreviousChar){this._hasPreviousChar=!1;const R=this.chunks[this.chunks.length-1];R.buffer+=String.fromCharCode(this._previousChar);const m=(0,U.createLineStartsFast)(R.buffer);R.lineStarts=m,this._previousChar===13&&this.cr++}}}r.PieceTreeTextBufferBuilder=O}),define(W[18],$([0,1]),function(z,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.refineServiceDecorator=r.createDecorator=r.IInstantiationService=r._util=void 0;var B;(function(O){O.serviceIds=new Map,O.DI_TARGET="$di$target",O.DI_DEPENDENCIES="$di$dependencies";function D(R){return R[O.DI_DEPENDENCIES]||[]}O.getServiceDependencies=D})(B=r._util||(r._util={})),r.IInstantiationService=P("instantiationService");function U(O,D,R,m){D[B.DI_TARGET]===D?D[B.DI_DEPENDENCIES].push({id:O,index:R,optional:m}):(D[B.DI_DEPENDENCIES]=[{id:O,index:R,optional:m}],D[B.DI_TARGET]=D)}function P(O){if(B.serviceIds.has(O))return B.serviceIds.get(O);const D=function(R,m,_){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");U(D,R,_,!1)};return D.toString=()=>O,B.serviceIds.set(O,D),D}r.createDecorator=P;function b(O){return O}r.refineServiceDecorator=b}),define(W[19],$([0,1,4,2,18]),function(z,r,B,U,P){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.implies=r.SET_CONTEXT_COMMAND_ID=r.IContextKeyService=r.RawContextKey=r.ContextKeyNotRegexExpr=r.ContextKeyRegexExpr=r.ContextKeySmallerEqualsExpr=r.ContextKeySmallerExpr=r.ContextKeyGreaterEqualsExpr=r.ContextKeyGreaterExpr=r.ContextKeyNotExpr=r.ContextKeyNotEqualsExpr=r.ContextKeyNotInExpr=r.ContextKeyInExpr=r.ContextKeyEqualsExpr=r.ContextKeyDefinedExpr=r.ContextKeyTrueExpr=r.ContextKeyFalseExpr=r.expressionsAreEqualWithConstantSubstitution=r.ContextKeyExpr=r.ContextKeyExprType=void 0;const b=new Map;b.set("false",!1),b.set("true",!0),b.set("isMac",B.isMacintosh),b.set("isLinux",B.isLinux),b.set("isWindows",B.isWindows),b.set("isWeb",B.isWeb),b.set("isMacNative",B.isMacintosh&&!B.isWeb),b.set("isEdge",B.isEdge),b.set("isFirefox",B.isFirefox),b.set("isChrome",B.isChrome),b.set("isSafari",B.isSafari);const O=Object.prototype.hasOwnProperty;var D;(function(w){w[w.False=0]="False",w[w.True=1]="True",w[w.Defined=2]="Defined",w[w.Not=3]="Not",w[w.Equals=4]="Equals",w[w.NotEquals=5]="NotEquals",w[w.And=6]="And",w[w.Regex=7]="Regex",w[w.NotRegex=8]="NotRegex",w[w.Or=9]="Or",w[w.In=10]="In",w[w.NotIn=11]="NotIn",w[w.Greater=12]="Greater",w[w.GreaterEquals=13]="GreaterEquals",w[w.Smaller=14]="Smaller",w[w.SmallerEquals=15]="SmallerEquals"})(D=r.ContextKeyExprType||(r.ContextKeyExprType={}));class R{static false(){return I.INSTANCE}static true(){return h.INSTANCE}static has(t){return N.create(t)}static equals(t,u){return v.create(t,u)}static notEquals(t,u){return e.create(t,u)}static regex(t,u){return C.create(t,u)}static in(t,u){return c.create(t,u)}static not(t){return i.create(t)}static and(...t){return S.create(t,null)}static or(...t){return p.create(t,null,!0)}static greater(t,u){return s.create(t,u)}static greaterEquals(t,u){return l.create(t,u)}static smaller(t,u){return o.create(t,u)}static smallerEquals(t,u){return L.create(t,u)}static deserialize(t,u=!1){if(!!t)return this._deserializeOrExpression(t,u)}static _deserializeOrExpression(t,u){let g=t.split("||");return p.create(g.map(A=>this._deserializeAndExpression(A,u)),null,!0)}static _deserializeAndExpression(t,u){let g=t.split("&&");return S.create(g.map(A=>this._deserializeOne(A,u)),null)}static _deserializeOne(t,u){if(t=t.trim(),t.indexOf("!=")>=0){let g=t.split("!=");return e.create(g[0].trim(),this._deserializeValue(g[1],u))}if(t.indexOf("==")>=0){let g=t.split("==");return v.create(g[0].trim(),this._deserializeValue(g[1],u))}if(t.indexOf("=~")>=0){let g=t.split("=~");return C.create(g[0].trim(),this._deserializeRegexValue(g[1],u))}if(t.indexOf(" in ")>=0){let g=t.split(" in ");return c.create(g[0].trim(),g[1].trim())}if(/^[^<=>]+>=[^<=>]+$/.test(t)){const g=t.split(">=");return l.create(g[0].trim(),g[1].trim())}if(/^[^<=>]+>[^<=>]+$/.test(t)){const g=t.split(">");return s.create(g[0].trim(),g[1].trim())}if(/^[^<=>]+<=[^<=>]+$/.test(t)){const g=t.split("<=");return L.create(g[0].trim(),g[1].trim())}if(/^[^<=>]+<[^<=>]+$/.test(t)){const g=t.split("<");return o.create(g[0].trim(),g[1].trim())}return/^\!\s*/.test(t)?i.create(t.substr(1).trim()):N.create(t)}static _deserializeValue(t,u){if(t=t.trim(),t==="true")return!0;if(t==="false")return!1;let g=/^'([^']*)'$/.exec(t);return g?g[1].trim():t}static _deserializeRegexValue(t,u){if((0,U.isFalsyOrWhitespace)(t)){if(u)throw new Error("missing regexp-value for =~-expression");return console.warn("missing regexp-value for =~-expression"),null}let g=t.indexOf("/"),A=t.lastIndexOf("/");if(g===A||g<0){if(u)throw new Error(`bad regexp-value '${t}', missing /-enclosure`);return console.warn(`bad regexp-value '${t}', missing /-enclosure`),null}let F=t.slice(g+1,A),x=t[A+1]==="i"?"i":"";try{return new RegExp(F,x)}catch(V){if(u)throw new Error(`bad regexp-value '${t}', parse error: ${V}`);return console.warn(`bad regexp-value '${t}', parse error: ${V}`),null}}}r.ContextKeyExpr=R;function m(w,t){const u=w?w.substituteConstants():void 0,g=t?t.substituteConstants():void 0;return!u&&!g?!0:!u||!g?!1:u.equals(g)}r.expressionsAreEqualWithConstantSubstitution=m;function _(w,t){return w.cmp(t)}class I{constructor(){this.type=0}cmp(t){return this.type-t.type}equals(t){return t.type===this.type}substituteConstants(){return this}evaluate(t){return!1}serialize(){return"false"}keys(){return[]}map(t){return this}negate(){return h.INSTANCE}}r.ContextKeyFalseExpr=I,I.INSTANCE=new I;class h{constructor(){this.type=1}cmp(t){return this.type-t.type}equals(t){return t.type===this.type}substituteConstants(){return this}evaluate(t){return!0}serialize(){return"true"}keys(){return[]}map(t){return this}negate(){return I.INSTANCE}}r.ContextKeyTrueExpr=h,h.INSTANCE=new h;class N{constructor(t,u){this.key=t,this.negated=u,this.type=2}static create(t,u=null){const g=b.get(t);return typeof g=="boolean"?g?h.INSTANCE:I.INSTANCE:new N(t,u)}cmp(t){return t.type!==this.type?this.type-t.type:y(this.key,t.key)}equals(t){return t.type===this.type?this.key===t.key:!1}substituteConstants(){const t=b.get(this.key);return typeof t=="boolean"?t?h.INSTANCE:I.INSTANCE:this}evaluate(t){return!!t.getValue(this.key)}serialize(){return this.key}keys(){return[this.key]}map(t){return t.mapDefined(this.key)}negate(){return this.negated||(this.negated=i.create(this.key,this)),this.negated}}r.ContextKeyDefinedExpr=N;class v{constructor(t,u,g){this.key=t,this.value=u,this.negated=g,this.type=4}static create(t,u,g=null){if(typeof u=="boolean")return u?N.create(t,g):i.create(t,g);const A=b.get(t);return typeof A=="boolean"?u===(A?"true":"false")?h.INSTANCE:I.INSTANCE:new v(t,u,g)}cmp(t){return t.type!==this.type?this.type-t.type:d(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){const t=b.get(this.key);if(typeof t=="boolean"){const u=t?"true":"false";return this.value===u?h.INSTANCE:I.INSTANCE}return this}evaluate(t){return t.getValue(this.key)==this.value}serialize(){return`${this.key} == '${this.value}'`}keys(){return[this.key]}map(t){return t.mapEquals(this.key,this.value)}negate(){return this.negated||(this.negated=e.create(this.key,this.value,this)),this.negated}}r.ContextKeyEqualsExpr=v;class c{constructor(t,u){this.key=t,this.valueKey=u,this.type=10,this.negated=null}static create(t,u){return new c(t,u)}cmp(t){return t.type!==this.type?this.type-t.type:d(this.key,this.valueKey,t.key,t.valueKey)}equals(t){return t.type===this.type?this.key===t.key&&this.valueKey===t.valueKey:!1}substituteConstants(){return this}evaluate(t){const u=t.getValue(this.valueKey),g=t.getValue(this.key);return Array.isArray(u)?u.indexOf(g)>=0:typeof g=="string"&&typeof u=="object"&&u!==null?O.call(u,g):!1}serialize(){return`${this.key} in '${this.valueKey}'`}keys(){return[this.key,this.valueKey]}map(t){return t.mapIn(this.key,this.valueKey)}negate(){return this.negated||(this.negated=a.create(this)),this.negated}}r.ContextKeyInExpr=c;class a{constructor(t){this._actual=t,this.type=11}static create(t){return new a(t)}cmp(t){return t.type!==this.type?this.type-t.type:this._actual.cmp(t._actual)}equals(t){return t.type===this.type?this._actual.equals(t._actual):!1}substituteConstants(){return this}evaluate(t){return!this._actual.evaluate(t)}serialize(){throw new Error("Method not implemented.")}keys(){return this._actual.keys()}map(t){return new a(this._actual.map(t))}negate(){return this._actual}}r.ContextKeyNotInExpr=a;class e{constructor(t,u,g){this.key=t,this.value=u,this.negated=g,this.type=5}static create(t,u,g=null){if(typeof u=="boolean")return u?i.create(t,g):N.create(t,g);const A=b.get(t);return typeof A=="boolean"?u===(A?"true":"false")?I.INSTANCE:h.INSTANCE:new e(t,u,g)}cmp(t){return t.type!==this.type?this.type-t.type:d(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){const t=b.get(this.key);if(typeof t=="boolean"){const u=t?"true":"false";return this.value===u?I.INSTANCE:h.INSTANCE}return this}evaluate(t){return t.getValue(this.key)!=this.value}serialize(){return`${this.key} != '${this.value}'`}keys(){return[this.key]}map(t){return t.mapNotEquals(this.key,this.value)}negate(){return this.negated||(this.negated=v.create(this.key,this.value,this)),this.negated}}r.ContextKeyNotEqualsExpr=e;class i{constructor(t,u){this.key=t,this.negated=u,this.type=3}static create(t,u=null){const g=b.get(t);return typeof g=="boolean"?g?I.INSTANCE:h.INSTANCE:new i(t,u)}cmp(t){return t.type!==this.type?this.type-t.type:y(this.key,t.key)}equals(t){return t.type===this.type?this.key===t.key:!1}substituteConstants(){const t=b.get(this.key);return typeof t=="boolean"?t?I.INSTANCE:h.INSTANCE:this}evaluate(t){return!t.getValue(this.key)}serialize(){return`!${this.key}`}keys(){return[this.key]}map(t){return t.mapNot(this.key)}negate(){return this.negated||(this.negated=N.create(this.key,this)),this.negated}}r.ContextKeyNotExpr=i;function n(w,t){if(typeof w=="string"){const u=parseFloat(w);isNaN(u)||(w=u)}return typeof w=="string"||typeof w=="number"?t(w):I.INSTANCE}class s{constructor(t,u,g){this.key=t,this.value=u,this.negated=g,this.type=12}static create(t,u,g=null){return n(u,A=>new s(t,A,g))}cmp(t){return t.type!==this.type?this.type-t.type:d(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))>this.value}serialize(){return`${this.key} > ${this.value}`}keys(){return[this.key]}map(t){return t.mapGreater(this.key,this.value)}negate(){return this.negated||(this.negated=L.create(this.key,this.value,this)),this.negated}}r.ContextKeyGreaterExpr=s;class l{constructor(t,u,g){this.key=t,this.value=u,this.negated=g,this.type=13}static create(t,u,g=null){return n(u,A=>new l(t,A,g))}cmp(t){return t.type!==this.type?this.type-t.type:d(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))>=this.value}serialize(){return`${this.key} >= ${this.value}`}keys(){return[this.key]}map(t){return t.mapGreaterEquals(this.key,this.value)}negate(){return this.negated||(this.negated=o.create(this.key,this.value,this)),this.negated}}r.ContextKeyGreaterEqualsExpr=l;class o{constructor(t,u,g){this.key=t,this.value=u,this.negated=g,this.type=14}static create(t,u,g=null){return n(u,A=>new o(t,A,g))}cmp(t){return t.type!==this.type?this.type-t.type:d(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))<this.value}serialize(){return`${this.key} < ${this.value}`}keys(){return[this.key]}map(t){return t.mapSmaller(this.key,this.value)}negate(){return this.negated||(this.negated=l.create(this.key,this.value,this)),this.negated}}r.ContextKeySmallerExpr=o;class L{constructor(t,u,g){this.key=t,this.value=u,this.negated=g,this.type=15}static create(t,u,g=null){return n(u,A=>new L(t,A,g))}cmp(t){return t.type!==this.type?this.type-t.type:d(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))<=this.value}serialize(){return`${this.key} <= ${this.value}`}keys(){return[this.key]}map(t){return t.mapSmallerEquals(this.key,this.value)}negate(){return this.negated||(this.negated=s.create(this.key,this.value,this)),this.negated}}r.ContextKeySmallerEqualsExpr=L;class C{constructor(t,u){this.key=t,this.regexp=u,this.type=7,this.negated=null}static create(t,u){return new C(t,u)}cmp(t){if(t.type!==this.type)return this.type-t.type;if(this.key<t.key)return-1;if(this.key>t.key)return 1;const u=this.regexp?this.regexp.source:"",g=t.regexp?t.regexp.source:"";return u<g?-1:u>g?1:0}equals(t){if(t.type===this.type){const u=this.regexp?this.regexp.source:"",g=t.regexp?t.regexp.source:"";return this.key===t.key&&u===g}return!1}substituteConstants(){return this}evaluate(t){let u=t.getValue(this.key);return this.regexp?this.regexp.test(u):!1}serialize(){const t=this.regexp?`/${this.regexp.source}/${this.regexp.ignoreCase?"i":""}`:"/invalid/";return`${this.key} =~ ${t}`}keys(){return[this.key]}map(t){return t.mapRegex(this.key,this.regexp)}negate(){return this.negated||(this.negated=T.create(this)),this.negated}}r.ContextKeyRegexExpr=C;class T{constructor(t){this._actual=t,this.type=8}static create(t){return new T(t)}cmp(t){return t.type!==this.type?this.type-t.type:this._actual.cmp(t._actual)}equals(t){return t.type===this.type?this._actual.equals(t._actual):!1}substituteConstants(){return this}evaluate(t){return!this._actual.evaluate(t)}serialize(){throw new Error("Method not implemented.")}keys(){return this._actual.keys()}map(t){return new T(this._actual.map(t))}negate(){return this._actual}}r.ContextKeyNotRegexExpr=T;function E(w){let t=null;for(let u=0,g=w.length;u<g;u++){const A=w[u].substituteConstants();if(w[u]!==A&&t===null){t=[];for(let F=0;F<u;F++)t[F]=w[F]}t!==null&&(t[u]=A)}return t===null?w:t}class S{constructor(t,u){this.expr=t,this.negated=u,this.type=6}static create(t,u){return S._normalizeArr(t,u)}cmp(t){if(t.type!==this.type)return this.type-t.type;if(this.expr.length<t.expr.length)return-1;if(this.expr.length>t.expr.length)return 1;for(let u=0,g=this.expr.length;u<g;u++){const A=_(this.expr[u],t.expr[u]);if(A!==0)return A}return 0}equals(t){if(t.type===this.type){if(this.expr.length!==t.expr.length)return!1;for(let u=0,g=this.expr.length;u<g;u++)if(!this.expr[u].equals(t.expr[u]))return!1;return!0}return!1}substituteConstants(){const t=E(this.expr);return t===this.expr?this:S.create(t,this.negated)}evaluate(t){for(let u=0,g=this.expr.length;u<g;u++)if(!this.expr[u].evaluate(t))return!1;return!0}static _normalizeArr(t,u){const g=[];let A=!1;for(const F of t)if(!!F){if(F.type===1){A=!0;continue}if(F.type===0)return I.INSTANCE;if(F.type===6){g.push(...F.expr);continue}g.push(F)}if(g.length===0&&A)return h.INSTANCE;if(g.length!==0){if(g.length===1)return g[0];g.sort(_);for(let F=1;F<g.length;F++)g[F-1].equals(g[F])&&(g.splice(F,1),F--);if(g.length===1)return g[0];for(;g.length>1;){const F=g[g.length-1];if(F.type!==9)break;g.pop();const x=g.pop(),V=g.length===0,q=p.create(F.expr.map(j=>S.create([j,x],null)),null,V);q&&(g.push(q),g.sort(_))}return g.length===1?g[0]:new S(g,u)}}serialize(){return this.expr.map(t=>t.serialize()).join(" && ")}keys(){const t=[];for(let u of this.expr)t.push(...u.keys());return t}map(t){return new S(this.expr.map(u=>u.map(t)),null)}negate(){if(!this.negated){const t=[];for(let u of this.expr)t.push(u.negate());this.negated=p.create(t,this,!0)}return this.negated}}class p{constructor(t,u){this.expr=t,this.negated=u,this.type=9}static create(t,u,g){return p._normalizeArr(t,u,g)}cmp(t){if(t.type!==this.type)return this.type-t.type;if(this.expr.length<t.expr.length)return-1;if(this.expr.length>t.expr.length)return 1;for(let u=0,g=this.expr.length;u<g;u++){const A=_(this.expr[u],t.expr[u]);if(A!==0)return A}return 0}equals(t){if(t.type===this.type){if(this.expr.length!==t.expr.length)return!1;for(let u=0,g=this.expr.length;u<g;u++)if(!this.expr[u].equals(t.expr[u]))return!1;return!0}return!1}substituteConstants(){const t=E(this.expr);return t===this.expr?this:p.create(t,this.negated,!1)}evaluate(t){for(let u=0,g=this.expr.length;u<g;u++)if(this.expr[u].evaluate(t))return!0;return!1}static _normalizeArr(t,u,g){let A=[],F=!1;if(t){for(let x=0,V=t.length;x<V;x++){const q=t[x];if(!!q){if(q.type===0){F=!0;continue}if(q.type===1)return h.INSTANCE;if(q.type===9){A=A.concat(q.expr);continue}A.push(q)}}if(A.length===0&&F)return I.INSTANCE;A.sort(_)}if(A.length!==0){if(A.length===1)return A[0];for(let x=1;x<A.length;x++)A[x-1].equals(A[x])&&(A.splice(x,1),x--);if(A.length===1)return A[0];if(g){for(let x=0;x<A.length;x++)for(let V=x+1;V<A.length;V++)k(A[x],A[V])&&(A.splice(V,1),V--);if(A.length===1)return A[0]}return new p(A,u)}}serialize(){return this.expr.map(t=>t.serialize()).join(" || ")}keys(){const t=[];for(let u of this.expr)t.push(...u.keys());return t}map(t){return new p(this.expr.map(u=>u.map(t)),null)}negate(){if(!this.negated){let t=[];for(let u of this.expr)t.push(u.negate());for(;t.length>1;){const u=t.shift(),g=t.shift(),A=[];for(const x of M(u))for(const V of M(g))A.push(S.create([x,V],null));const F=t.length===0;t.unshift(p.create(A,null,F))}this.negated=t[0]}return this.negated}}class f extends N{constructor(t,u,g){super(t,null);this._defaultValue=u,typeof g=="object"?f._info.push({...g,key:t}):g!==!0&&f._info.push({key:t,description:g,type:u!=null?typeof u:void 0})}static all(){return f._info.values()}bindTo(t){return t.createKey(this.key,this._defaultValue)}getValue(t){return t.getContextKeyValue(this.key)}toNegated(){return this.negate()}isEqualTo(t){return v.create(this.key,t)}notEqualsTo(t){return e.create(this.key,t)}}r.RawContextKey=f,f._info=[],r.IContextKeyService=(0,P.createDecorator)("contextKeyService"),r.SET_CONTEXT_COMMAND_ID="setContext";function y(w,t){return w<t?-1:w>t?1:0}function d(w,t,u,g){return w<u?-1:w>u?1:t<g?-1:t>g?1:0}function k(w,t){if(t.type===6&&w.type!==9&&w.type!==6){for(const A of t.expr)if(w.equals(A))return!0}const u=w.negate(),g=M(u).concat(M(t));g.sort(_);for(let A=0;A<g.length;A++){const x=g[A].negate();for(let V=A+1;V<g.length;V++){const q=g[V];if(x.equals(q))return!0}}return!1}r.implies=k;function M(w){return w.type===9?w.expr:[w]}}),define(W[20],$([0,1,25,26,7,27,8,4,19]),function(z,r,B,U,P,b,O,D,R){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.NotebookWorkingCopyTypeIdentifier=r.CellStatusbarAlignment=r.NotebookSetting=r.CellSequence=r.notebookDocumentFilterMatch=r.isDocumentExcludePattern=r.NotebookEditorPriority=r.NOTEBOOK_EDITOR_CURSOR_BOUNDARY=r.diff=r.MimeTypeDisplayOrder=r.mimeTypeIsMergeable=r.mimeTypeSupportedByCore=r.mimeTypeIsAlwaysSecure=r.CellUri=r.CellEditType=r.SelectionStateType=r.NotebookCellsChangeType=r.RendererMessagingSpec=r.NotebookRendererMatch=r.NotebookCellExecutionState=r.NotebookRunState=r.RENDERER_NOT_AVAILABLE=r.BUILTIN_RENDERER_ID=r.RENDERER_EQUIVALENT_EXTENSIONS=r.ACCESSIBLE_NOTEBOOK_DISPLAY_ORDER=r.NOTEBOOK_DISPLAY_ORDER=r.CellKind=r.NOTEBOOK_DIFF_EDITOR_ID=r.NOTEBOOK_EDITOR_ID=void 0,r.NOTEBOOK_EDITOR_ID="workbench.editor.notebook",r.NOTEBOOK_DIFF_EDITOR_ID="workbench.editor.notebookTextDiffEditor";var m;(function(d){d[d.Markup=1]="Markup",d[d.Code=2]="Code"})(m=r.CellKind||(r.CellKind={})),r.NOTEBOOK_DISPLAY_ORDER=["application/json","application/javascript","text/html","image/svg+xml",P.Mimes.latex,P.Mimes.markdown,"image/png","image/jpeg",P.Mimes.text],r.ACCESSIBLE_NOTEBOOK_DISPLAY_ORDER=[P.Mimes.latex,P.Mimes.markdown,"application/json",P.Mimes.text,"text/html","image/svg+xml","image/png","image/jpeg"],r.RENDERER_EQUIVALENT_EXTENSIONS=new Map([["ms-toolsai.jupyter",new Set(["jupyter-notebook","interactive"])],["ms-toolsai.jupyter-renderers",new Set(["jupyter-notebook","interactive"])]]),r.BUILTIN_RENDERER_ID="_builtin",r.RENDERER_NOT_AVAILABLE="_notAvailable";var _;(function(d){d[d.Running=1]="Running",d[d.Idle=2]="Idle"})(_=r.NotebookRunState||(r.NotebookRunState={}));var I;(function(d){d[d.Pending=2]="Pending",d[d.Executing=3]="Executing"})(I=r.NotebookCellExecutionState||(r.NotebookCellExecutionState={}));var h;(function(d){d[d.WithHardKernelDependency=0]="WithHardKernelDependency",d[d.WithOptionalKernelDependency=1]="WithOptionalKernelDependency",d[d.Pure=2]="Pure",d[d.Never=3]="Never"})(h=r.NotebookRendererMatch||(r.NotebookRendererMatch={}));var N;(function(d){d.Always="always",d.Never="never",d.Optional="optional"})(N=r.RendererMessagingSpec||(r.RendererMessagingSpec={}));var v;(function(d){d[d.ModelChange=1]="ModelChange",d[d.Move=2]="Move",d[d.ChangeLanguage=5]="ChangeLanguage",d[d.Initialize=6]="Initialize",d[d.ChangeCellMetadata=7]="ChangeCellMetadata",d[d.Output=8]="Output",d[d.OutputItem=9]="OutputItem",d[d.ChangeCellContent=10]="ChangeCellContent",d[d.ChangeDocumentMetadata=11]="ChangeDocumentMetadata",d[d.ChangeCellInternalMetadata=12]="ChangeCellInternalMetadata",d[d.ChangeCellMime=13]="ChangeCellMime",d[d.Unknown=100]="Unknown"})(v=r.NotebookCellsChangeType||(r.NotebookCellsChangeType={}));var c;(function(d){d[d.Handle=0]="Handle",d[d.Index=1]="Index"})(c=r.SelectionStateType||(r.SelectionStateType={}));var a;(function(d){d[d.Replace=1]="Replace",d[d.Output=2]="Output",d[d.Metadata=3]="Metadata",d[d.CellLanguage=4]="CellLanguage",d[d.DocumentMetadata=5]="DocumentMetadata",d[d.Move=6]="Move",d[d.OutputItems=7]="OutputItems",d[d.PartialMetadata=8]="PartialMetadata",d[d.PartialInternalMetadata=9]="PartialInternalMetadata"})(a=r.CellEditType||(r.CellEditType={}));var e;(function(d){d.scheme=b.Schemas.vscodeNotebookCell;const k=/^ch(\d{7,})/;function M(F,x){return F.with({scheme:d.scheme,fragment:`ch${x.toString().padStart(7,"0")}${F.scheme!==b.Schemas.file?F.scheme:""}`})}d.generate=M;function w(F){if(F.scheme!==d.scheme)return;const x=k.exec(F.fragment);return x?{handle:Number(x[1]),notebook:F.with({scheme:F.fragment.substring(x[0].length)||b.Schemas.file,fragment:null})}:void 0}d.parse=w;function t(F,x,V){return F.with({scheme:b.Schemas.vscodeNotebookCellOutput,fragment:`ch${x.toString().padStart(7,"0")},${V??""},${F.scheme!==b.Schemas.file?F.scheme:""}`})}d.generateCellOutputUri=t;function u(F){if(F.scheme!==b.Schemas.vscodeNotebookCellOutput)return;const x=/^ch(\d{7,})\,([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})?\,(.*)$/i.exec(F.fragment);if(!x)return;const V=Number(x[1]),q=x[2]&&x[2]!==""?x[2]:void 0,j=x[3];return{handle:V,outputId:q,notebook:F.with({scheme:j||b.Schemas.file,fragment:null})}}d.parseCellOutputUri=u;function g(F,x,V){return F.with({scheme:V,fragment:`ch${x.toString().padStart(7,"0")}${F.scheme!==b.Schemas.file?F.scheme:""}`})}d.generateCellUri=g;function A(F,x){if(F.scheme!==x)return;const V=k.exec(F.fragment);return V?{handle:Number(V[1]),notebook:F.with({scheme:F.fragment.substring(V[0].length)||b.Schemas.file,fragment:null})}:void 0}d.parseCellUri=A})(e=r.CellUri||(r.CellUri={}));const i=new Map([["application/javascript",{supportedByCore:!0}],["image/png",{alwaysSecure:!0,supportedByCore:!0}],["image/jpeg",{alwaysSecure:!0,supportedByCore:!0}],["image/git",{alwaysSecure:!0,supportedByCore:!0}],["image/svg+xml",{supportedByCore:!0}],["application/json",{alwaysSecure:!0,supportedByCore:!0}],[P.Mimes.text,{alwaysSecure:!0,supportedByCore:!0}],["text/html",{supportedByCore:!0}],["text/x-javascript",{alwaysSecure:!0,supportedByCore:!0}],["application/vnd.code.notebook.error",{alwaysSecure:!0,supportedByCore:!0}],["application/vnd.code.notebook.stdout",{alwaysSecure:!0,supportedByCore:!0,mergeable:!0}],["application/vnd.code.notebook.stderr",{alwaysSecure:!0,supportedByCore:!0,mergeable:!0}]]);function n(d){return i.get(d)?.alwaysSecure??!1}r.mimeTypeIsAlwaysSecure=n;function s(d){return i.get(d)?.supportedByCore??!1}r.mimeTypeSupportedByCore=s;function l(d){return i.get(d)?.mergeable??!1}r.mimeTypeIsMergeable=l;const o=d=>D.isWindows?d.replace(/\//g,"\\"):d;class L{constructor(k=[],M=r.NOTEBOOK_DISPLAY_ORDER){this.defaultOrder=M,this.order=[...new Set(k)].map(w=>({pattern:w,matches:B.parse(o(w))}))}sort(k){const M=new Map(U.Iterable.map(k,t=>[t,o(t)]));let w=[];for(const{matches:t}of this.order)for(const[u,g]of M)if(t(g)){w.push(u),M.delete(u);break}return M.size&&(w=w.concat([...M.keys()].sort((t,u)=>this.defaultOrder.indexOf(t)-this.defaultOrder.indexOf(u)))),w}prioritize(k,M){const w=this.findIndex(k);if(w===-1){this.order.unshift({pattern:k,matches:B.parse(o(k))});return}const t=new Set(M.map(g=>this.findIndex(g,w)));t.delete(-1);const u=Array.from(t).sort();this.order.splice(w+1,0,...u.map(g=>this.order[g]));for(let g=u.length-1;g>=0;g--)this.order.splice(u[g],1)}toArray(){return this.order.map(k=>k.pattern)}findIndex(k,M=this.order.length){const w=o(k);for(let t=0;t<M;t++)if(this.order[t].matches(w))return t;return-1}}r.MimeTypeDisplayOrder=L;function C(d,k,M,w=(t,u)=>t===u){const t=[];function u(F,x,V){if(x===0&&V.length===0)return;const q=t[t.length-1];q&&q.start+q.deleteCount===F?(q.deleteCount+=x,q.toInsert.push(...V)):t.push({start:F,deleteCount:x,toInsert:V})}let g=0,A=0;for(;;){if(g===d.length){u(g,0,k.slice(A));break}if(A===k.length){u(g,d.length-g,[]);break}const F=d[g],x=k[A];if(w(F,x)){g+=1,A+=1;continue}M(x)?(u(g,1,[]),g+=1):(u(g,0,[x]),A+=1)}return t}r.diff=C,r.NOTEBOOK_EDITOR_CURSOR_BOUNDARY=new R.RawContextKey("notebookEditorCursorAtBoundary","none");var T;(function(d){d.default="default",d.option="option"})(T=r.NotebookEditorPriority||(r.NotebookEditorPriority={}));function E(d){const k=d;return!!((typeof k.include=="string"||B.isRelativePattern(k.include))&&(typeof k.exclude=="string"||B.isRelativePattern(k.exclude)))}r.isDocumentExcludePattern=E;function S(d,k,M){if(Array.isArray(d.viewType)&&d.viewType.indexOf(k)>=0||d.viewType===k)return!0;if(d.filenamePattern){const w=E(d.filenamePattern)?d.filenamePattern.include:d.filenamePattern,t=E(d.filenamePattern)?d.filenamePattern.exclude:void 0;if(B.match(w,(0,O.basename)(M.fsPath).toLowerCase()))return!(t&&B.match(t,(0,O.basename)(M.fsPath).toLowerCase()))}return!1}r.notebookDocumentFilterMatch=S;class p{constructor(k){this.textModel=k}getElements(){const k=new Int32Array(this.textModel.cells.length);for(let M=0;M<this.textModel.cells.length;M++)k[M]=this.textModel.cells[M].getHashValue();return k}}r.CellSequence=p,r.NotebookSetting={displayOrder:"notebook.displayOrder",cellToolbarLocation:"notebook.cellToolbarLocation",cellToolbarVisibility:"notebook.cellToolbarVisibility",showCellStatusBar:"notebook.showCellStatusBar",textDiffEditorPreview:"notebook.diff.enablePreview",experimentalInsertToolbarAlignment:"notebook.experimental.insertToolbarAlignment",compactView:"notebook.compactView",focusIndicator:"notebook.cellFocusIndicator",insertToolbarLocation:"notebook.insertToolbarLocation",globalToolbar:"notebook.globalToolbar",undoRedoPerCell:"notebook.undoRedoPerCell",consolidatedOutputButton:"notebook.consolidatedOutputButton",showFoldingControls:"notebook.showFoldingControls",dragAndDropEnabled:"notebook.dragAndDropEnabled",cellEditorOptionsCustomizations:"notebook.editorOptionsCustomizations",consolidatedRunButton:"notebook.consolidatedRunButton",openGettingStarted:"notebook.experimental.openGettingStarted",textOutputLineLimit:"notebook.output.textLineLimit",globalToolbarShowLabel:"notebook.globalToolbarShowLabel",markupFontSize:"notebook.markup.fontSize",interactiveWindowCollapseCodeCells:"interactiveWindow.collapseCellInputCode"};var f;(function(d){d[d.Left=1]="Left",d[d.Right=2]="Right"})(f=r.CellStatusbarAlignment||(r.CellStatusbarAlignment={}));class y{static create(k){return`${y._prefix}${k}`}static parse(k){if(k.startsWith(y._prefix))return k.substring(y._prefix.length)}}r.NotebookWorkingCopyTypeIdentifier=y,y._prefix="notebook/"}),define(W[28],$([0,1,29,30,31,17,20,6]),function(z,r,B,U,P,b,O,D){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.create=r.NotebookEditorSimpleWorker=r.CellSequence=void 0;function R(v){let c=(0,U.numberHash)(104579,0);for(let a=0;a<v.buffer.length;a++)c=(0,U.doHash)(v.buffer[a],c);return c}class m{constructor(c,a,e,i,n,s,l){this.handle=c,this._source=a,this.language=e,this.cellKind=i,this.outputs=n,this.metadata=s,this.internalMetadata=l,this._primaryKey=null,this._hash=null}get textBuffer(){if(this._textBuffer)return this._textBuffer;const c=new b.PieceTreeTextBufferBuilder;c.acceptChunk(Array.isArray(this._source)?this._source.join(`
`):this._source);const a=c.finish(!0);return this._textBuffer=a.create(1).textBuffer,this._textBuffer}primaryKey(){return this._primaryKey===void 0&&(this._primaryKey=(0,U.hash)(this.getValue())),this._primaryKey}getFullModelRange(){const c=this.textBuffer.getLineCount();return new D.Range(1,1,c,this.textBuffer.getLineLength(c)+1)}getValue(){const c=this.getFullModelRange();return this.textBuffer.getEOL()===`
`?this.textBuffer.getValueInRange(c,1):this.textBuffer.getValueInRange(c,2)}getComparisonValue(){return this._primaryKey!==null?this._primaryKey:(this._hash=(0,U.hash)([(0,U.hash)(this.language),(0,U.hash)(this.getValue()),this.metadata,this.internalMetadata,this.outputs.map(c=>({outputs:c.outputs.map(a=>({mime:a.mime,data:R(a.data)})),metadata:c.metadata}))]),this._hash)}getHashValue(){return this._hash!==null?this._hash:(this._hash=(0,U.hash)([(0,U.hash)(this.getValue()),this.language,this.metadata,this.internalMetadata]),this._hash)}}class _{constructor(c,a,e){this.uri=c,this.cells=a,this.metadata=e}acceptModelChanged(c){c.rawEvents.forEach(a=>{if(a.kind===O.NotebookCellsChangeType.ModelChange)this._spliceNotebookCells(a.changes);else if(a.kind===O.NotebookCellsChangeType.Move){const e=this.cells.splice(a.index,1);this.cells.splice(a.newIdx,0,...e)}else if(a.kind===O.NotebookCellsChangeType.Output){const e=this.cells[a.index];e.outputs=a.outputs}else if(a.kind===O.NotebookCellsChangeType.ChangeLanguage){const e=this.cells[a.index];e.language=a.language}else if(a.kind===O.NotebookCellsChangeType.ChangeCellMetadata){const e=this.cells[a.index];e.metadata=a.metadata}else if(a.kind===O.NotebookCellsChangeType.ChangeCellInternalMetadata){const e=this.cells[a.index];e.internalMetadata=a.internalMetadata}})}_spliceNotebookCells(c){c.reverse().forEach(a=>{const i=a[2].map(n=>new m(n.handle,n.source,n.language,n.cellKind,n.outputs,n.metadata));this.cells.splice(a[0],a[1],...i)})}}class I{constructor(c){this.textModel=c}getElements(){const c=new Int32Array(this.textModel.cells.length);for(let a=0;a<this.textModel.cells.length;a++)c[a]=this.textModel.cells[a].getComparisonValue();return c}getCellHash(c){const a=Array.isArray(c.source)?c.source.join(`
`):c.source;return(0,U.hash)([(0,U.hash)(a),c.metadata])}}r.CellSequence=I;class h{constructor(){this._models=Object.create(null)}dispose(){}acceptNewModel(c,a){this._models[c]=new _(P.URI.parse(c),a.cells.map(e=>new m(e.handle,e.source,e.language,e.cellKind,e.outputs,e.metadata)),a.metadata)}acceptModelChanged(c,a){const e=this._models[c];e&&e.acceptModelChanged(a)}acceptRemovedModel(c){!this._models[c]||delete this._models[c]}computeDiff(c,a){const e=this._getModel(c),i=this._getModel(a);return{cellsDiff:new B.LcsDiff(new I(e),new I(i)).ComputeDiff(!1)}}_getModel(c){return this._models[c]}}r.NotebookEditorSimpleWorker=h;function N(v){return new h}r.create=N})}).call(this);

//# sourceMappingURL=notebookSimpleWorker.js.map
